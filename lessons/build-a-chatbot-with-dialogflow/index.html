<!DOCTYPE html>
<html class="dark">
  
<!-- Mirrored from Kodeville.io/lessons/build-a-chatbot-with-dialogflow/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:07:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Build a Chatbot With Dialogflow</title>
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../../svelte/index.be288b01.css" />
    <script type="module" defer src="../../svelte/index.3d7fd5b5.js" /></script>

    
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="../../img/favicon.png" />
    <meta name="theme-color" content="#454e56">
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <link rel="manifest" href="../../manifest.json">
    

 




    <link rel="canonical" href="index.html" />

    <meta name="description" content="Build a fullstack conversational experience with Dialogflow and Firebase Cloud Functions.">
    <meta name="image" content="https://Kodeville.io/lessons/build-a-chatbot-with-dialogflow/img/featured.png">

    <meta property="og:title" content="Build a Chatbot With Dialogflow" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://Kodeville.io/lessons/build-a-chatbot-with-dialogflow/" />
    <meta property="og:image" content="https://Kodeville.io/lessons/build-a-chatbot-with-dialogflow/img/featured.png" />
    <meta property="og:description" content="Build a fullstack conversational experience with Dialogflow and Firebase Cloud Functions." />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Kodeville_dev">
    <meta name="twitter:title" content="Build a Chatbot With Dialogflow">
    <meta name="twitter:description" content="Build a fullstack conversational experience with Dialogflow and Firebase Cloud Functions.">
    <meta name="twitter:image" content="https://Kodeville.io/lessons/build-a-chatbot-with-dialogflow/img/featured.png">
    
    <script>
      if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
              navigator.serviceWorker.register('../../sw.js');
          });
      }
    </script>

  </head>
  <body>
    <global-data 
    permalink="https://Kodeville.io/lessons/build-a-chatbot-with-dialogflow/" 
    vimeo=""
    youtube="0NXqwT3Y09E"
    free=""
    next="https://Kodeville.io/lessons/sql-firebase-typeorm/" 
    prev="https://Kodeville.io/lessons/algolia-cloud-functions/">
  </global-data>

    
<nav class="flex justify-between container p-6 md:p-8">
  <a
    class="flex justify-center items-center text-center w-12 h-12 logo-gif"
    href="../../index.html"
  >
    <img id="logo" src="../../img/logo.svg" alt="logo" />
    <img class="relative bottom-1 left-1" id="logoBg" src="../../img/fire.gif" alt="fire background" />
  </a>

  <ul class="flex justify-center items-center">
    <if-pro>
      <li slot="basic" class="mx-2 md:mx-4  hover:scale-105 transition-transform">
        <a href="../../pro/index.html" class="font-display text-base font-normal text-green-500 border-green-400 border rounded-md px-2 py-1 hover:drop-shadow-[0_0_9px_rgba(34,197,94,0.9)]">PRO</a>
      </li>
    </if-pro>
    <li class="mx-2 md:mx-4 hover:scale-105 transition-transform">
      <a href="../index.html" class="font-sans text-xl font-bold leading-none text-gray2 hover:text-white">labs</a>
    </li>
    <li class="mx-2 md:mx-4  hover:scale-105 transition-transform">
      <a href="../../courses/index.html" class="font-sans text-xl font-bold leading-none text-gray2 gradient-slide">courses</a>
    </li>
    <li class="ml-2">
      <modal-action type="open" name="search">
        <button class="p-2 mr-2 hidden md:flex justify-between items-center bg-white bg-opacity-10 hover:bg-opacity-20 border border-gray4 hover:border-purple-500 
                 shadow-xl hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all">
          <span class="text-gray2 w-4 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
          <span class="mr-12">Search</span>
          <span class="mx-2 text-xs border border-gray4 rounded-md p-1 px-2">/</span>
        </button>
        <button class="flex md:hidden">
          <span class="text-gray2 w-6 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
        </button>
        </modal-action>
      </li>
    <li class="ml-2 mr-6 relative">
      <if-user>
        <a href="../../dashboard/index.html">
          <user-avatar></user-avatar>
        </a>
        <modal-action slot="signed-out" name="signin" type="open">
          <button class="relative hidden md:inline-block px-4 py-2 text-xl font-display text-black hover:text-white bg-white 
                hover:bg-purple-600 drop-shadow-[6px_6px_0_black] hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all duration-300">
            login
          </button>
          <button class="flex md:hidden">
            <span class="text-gray2 w-6 mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M352 96h64c17.7 0 32 14.3 32 32V384c0 17.7-14.3 32-32 32H352c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c53 0 96-43 96-96V128c0-53-43-96-96-96H352c-17.7 0-32 14.3-32 32s14.3 32 32 32zm-7.5 177.4c4.8-4.5 7.5-10.8 7.5-17.4s-2.7-12.9-7.5-17.4l-144-136c-7-6.6-17.2-8.4-26-4.6s-14.5 12.5-14.5 22v72H32c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32H160v72c0 9.6 5.7 18.2 14.5 22s19 2 26-4.6l144-136z"/></svg>
</span>
          </button>
        </modal-action>
      </if-user>
    </li>


  </ul>
</nav>


    
<main class="container">


	<div class="flex w-full justify-between">


		<article itemscope itemtype="http://schema.org/Article" class="w-full">
			<meta itemprop="datePublished" content="2019-08-12 09:45:18 -0700 -0700" />
			<meta itemprop="dateModified" content="2019-08-12 09:45:18 -0700 -0700" />
			<meta itemprop="image" content="img/featured.png" />
			<meta itemprop="publisher" content="Kodeville.io" />


			<header>

				
				
				<div itemprop="video" itemscope itemtype="http://schema.org/VideoObject">
					<iframe class="w-full aspect-video" src="https://www.youtube.com/embed/0NXqwT3Y09E"
						frameborder="0"
						allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen></iframe>

					<meta itemprop="embedUrl" content="https://www.youtube.com/embed/0NXqwT3Y09E" />
					<meta itemprop="thumbnailUrl" content="" />
					<meta itemprop="description" content="Build a fullstack conversational experience with Dialogflow and Firebase Cloud Functions." />
					<meta itemprop="uploadDate" content="2019-08-12 09:45:18 -0700 -0700" />
					<meta itemprop="publisher" content="Kodeville" />
				</div>
				

				

				<div class="bg-gray6 py-5 px-3 rounded-lg mb-4 flex justify-between mt-3">

					
					
					<a class="flex items-center no-underline" itemprop="author" name="Jeff Delaney" href="../../contributors/jeff-delaney/index.html">
						<img class="w-10 h-10 rounded-full block" src="../../contributors/img/jeff-delaney.webp" alt="Jeff Delaney avatar">
						<span class="flex flex-col ml-2">
							<span class="no-underline">By Jeff Delaney</span>
							<span class="text-xs text-gray4">Posted <time itemprop="dateModified">Aug 12, 2019</time>
						</span>
	
					</a>

					
					<span>
						
							<a href="../../tags/cloud-functions/index.html"><span class="tag tag-cloud-functions">#cloud-functions</span></a>
						
							<a href="../../tags/node/index.html"><span class="tag tag-node">#node</span></a>
						
							<a href="../../tags/dialogflow/index.html"><span class="tag tag-dialogflow">#dialogflow</span></a>
						
							<a href="../../tags/angular/index.html"><span class="tag tag-angular">#angular</span></a>
						

						
							<a class="btn btn-transparent ml-4" href="https://github.com/Kodeville-io/202-chatbot-dialogflow">
								Source Code
							</a>
						
					</span>
					
				
				</div>

			</header>



			
			<section class="prose dark:prose-invert max-w-full lesson-content" itemprop="articleBody">
				


				<h1 itemprop="name headline" id="build-a-chatbot-with-dialogflow" class="gradient-text">
					Build a Chatbot With Dialogflow
				</h1>


				<p><a href="https://en.wikipedia.org/wiki/Chatbot">Chatbots</a> make it possible for the average developer to deliver excellent (and affordable) customer service at scale - Building conversational experiences has never been easier thanks to the  <a href="https://dialogflow.com/">Dialogflow</a> conversation platform.</p>
<p>Dialogflow is a free tool on Google Cloud for creating voice and text conversational interfaces. It uses Natural Language Processing <a href="https://www.kaggle.com/romanj86/introduction-to-nlp/data">NLP</a> technology, allowing you to create experiences similar to Google Assistant or Amazon Alexa. In following lesson creates a chatbot from scratch in the three main steps:</p>
<ol>
<li>Create a chatbot on the Dialogflow Console</li>
<li>Connect it to Firebase Cloud Functions (NodeJS)</li>
<li>Interact with it from frontend Angular app</li>
</ol>
<h2 id="part-1-create-a-chatbot">Part 1: Create a Chatbot</h2>
<p>Before getting started, it is recommended that you have an existing Firebase or GCP project.</p>
<h3 id="create-an-agent">Create an Agent</h3>
<p>An agent is basically a entity that contains the knowledge and behaviors used to respond to phrases and fulfill user intentions.</p>
<figure><img src="img/agent.png"
         alt="Create the Dialogflow Agent"/><figcaption>
            <p>Create the Dialogflow Agent</p>
        </figcaption>
</figure>

<h3 id="create-an-intent">Create an Intent</h3>
<p>Think of a conversation as a <strong>turn-based game</strong>. An <a href="https://cloud.google.com/dialogflow/docs/intents-overview">Intent</a> represents the end-user&rsquo;s goal or intention based on their last turn. When the bot is able to classify the intent, it can respond with useful information.</p>
<p>Example:</p>
<blockquote>
<p>USER: Can you change my username to bob23</p>
</blockquote>
<p>Bot recognizes question/intent and fulfills the request by updating Firestore from a Cloud Function.</p>
<blockquote>
<p>BOT: Absolutely, it has been updated in the database!</p>
</blockquote>
<figure><img src="img/intent-train.png"/>
</figure>

<h3 id="actions-and-parameters">Actions and Parameters</h3>
<p>In this example, we want our bot to determine the user&rsquo;s preferred display name and favorite color. We can do that by providing prompts that extract that data. After all required params have been extracted, we will use them to permanently update the user&rsquo;s record in the Firestore database. Dialogflow will ask the questions specified as <em>prompts</em> until it receives a valid <em>entity</em> value for that param.</p>
<figure><img src="img/params.png"
         alt="Dialogflow action and params"/>
</figure>

<h3 id="responses-and-fulfillment">Responses and Fulfillment</h3>
<p>When an intent is completed you can setup a simple response in the Dialogflow console OR you can handle the fulfillment with a webhook. Enable a webhook call for this function.</p>
<figure><img src="img/webhook-fulfill.png"
         alt="Dialogflow webhook fulfillment"/>
</figure>

<h2 id="part-2-backend-cloud-functions">Part 2: Backend Cloud Functions</h2>
<p>Communicating with Dialogflow must be done on the server. In this section, we create HTTP Cloud Functions that enable frontend applications to communication with our agent.</p>
<h3 id="add-your-service-account">Add your Service Account</h3>
<p>Dialogflow requires your full <a href="https://firebase.google.com/docs/admin/setup#initialize_the_sdk">service account</a>. Download it from the Firebase Console to <code>functions/service-account.json</code>.</p>
<p>‚ö†Ô∏è Make sure to add the service account path to your <code>.gitignore</code> because it contains sensitive API keys that should not be exposed publicly.</p>
<figure><img src="img/functions-service-account.png"
         alt="Download your service account"/><figcaption>
            <p>Download your service account</p>
        </figcaption>
</figure>

<h3 id="handling-conversations">Handling Conversations</h3>
<p>This first function is a generic endpoint that allows a frontend app to connect to the <a href="https://github.com/googleapis/nodejs-dialogflow">Dialogflow API</a>. The function expects the client to pass a <code>sessionId</code>, which is just a string that allows the bot to understand the current context of a conversation. It also expects the users <code>queryInput</code> text, which is what the user is saying to the bot.</p>


<div class="file-name">
  <span class="file-icon"><svg aria-hidden="true" data-prefix="fas" data-icon="terminal" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svgterminal  "><path fill="currentColor" d="M257.981 272.971L63.638 467.314c-9.373 9.373-24.569 9.373-33.941 0L7.029 444.647c-9.357-9.357-9.375-24.522-.04-33.901L161.011 256 6.99 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L257.981 239.03c9.373 9.372 9.373 24.568 0 33.941zM640 456v-32c0-13.255-10.745-24-24-24H312c-13.255 0-24 10.745-24 24v32c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24z" ></path></svg></span> command line
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">cd functions
</span></span><span class="line"><span class="cl">npm i dialogflow cors
</span></span></code></pre></div>

<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_js</title><path d="M18.774,19.7a3.727,3.727,0,0,0,3.376,2.078c1.418,0,2.324-.709,2.324-1.688,0-1.173-.931-1.589-2.491-2.272l-.856-.367c-2.469-1.052-4.11-2.37-4.11-5.156,0-2.567,1.956-4.52,5.012-4.52A5.058,5.058,0,0,1,26.9,10.52l-2.665,1.711a2.327,2.327,0,0,0-2.2-1.467,1.489,1.489,0,0,0-1.638,1.467c0,1.027.636,1.442,2.1,2.078l.856.366c2.908,1.247,4.549,2.518,4.549,5.376,0,3.081-2.42,4.769-5.671,4.769a6.575,6.575,0,0,1-6.236-3.5ZM6.686,20c.538.954,1.027,1.76,2.2,1.76,1.124,0,1.834-.44,1.834-2.15V7.975h3.422V19.658c0,3.543-2.078,5.156-5.11,5.156A5.312,5.312,0,0,1,3.9,21.688Z" style="fill:#f5de19"/></svg>
</span> index.js
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;firebase-functions&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">)({</span> <span class="nx">origin</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;firebase-admin&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">serviceAccount</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./service-account.json&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">admin</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">credential</span><span class="o">:</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">credential</span><span class="p">.</span><span class="nx">cert</span><span class="p">(</span><span class="nx">serviceAccount</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">databaseURL</span><span class="o">:</span> <span class="s2">&#34;https://Kodeville-lessons.firebaseio.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">SessionsClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dialogflow&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">dialogflowGateway</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cors</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span> <span class="nx">queryInput</span><span class="p">,</span> <span class="nx">sessionId</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">sessionClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SessionsClient</span><span class="p">({</span> <span class="nx">credentials</span><span class="o">:</span> <span class="nx">serviceAccount</span>  <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">sessionClient</span><span class="p">.</span><span class="nx">sessionPath</span><span class="p">(</span><span class="s1">&#39;your-project&#39;</span><span class="p">,</span> <span class="nx">sessionId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">responses</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">sessionClient</span><span class="p">.</span><span class="nx">detectIntent</span><span class="p">({</span> <span class="nx">session</span><span class="p">,</span> <span class="nx">queryInput</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">responses</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">queryResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><h3 id="fulfilling-intents-with-a-webhook">Fulfilling Intents with a Webhook</h3>
<p>The benefit of a webhook is that you can perform additional backend logic, like updating a database or reaching out to a another API, then format the response to the user dynamically. In this example, we take the <em>name</em> and <em>color</em> parameters from the user&rsquo;s conversation and update their account in Firestore.</p>


<div class="file-name">
  <span class="file-icon"><svg aria-hidden="true" data-prefix="fas" data-icon="terminal" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svgterminal  "><path fill="currentColor" d="M257.981 272.971L63.638 467.314c-9.373 9.373-24.569 9.373-33.941 0L7.029 444.647c-9.357-9.357-9.375-24.522-.04-33.901L161.011 256 6.99 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L257.981 239.03c9.373 9.372 9.373 24.568 0 33.941zM640 456v-32c0-13.255-10.745-24-24-24H312c-13.255 0-24 10.745-24 24v32c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24z" ></path></svg></span> command line
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">npm i dialogflow-fulfillment actions-on-google
</span></span></code></pre></div>

<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_js</title><path d="M18.774,19.7a3.727,3.727,0,0,0,3.376,2.078c1.418,0,2.324-.709,2.324-1.688,0-1.173-.931-1.589-2.491-2.272l-.856-.367c-2.469-1.052-4.11-2.37-4.11-5.156,0-2.567,1.956-4.52,5.012-4.52A5.058,5.058,0,0,1,26.9,10.52l-2.665,1.711a2.327,2.327,0,0,0-2.2-1.467,1.489,1.489,0,0,0-1.638,1.467c0,1.027.636,1.442,2.1,2.078l.856.366c2.908,1.247,4.549,2.518,4.549,5.376,0,3.081-2.42,4.769-5.671,4.769a6.575,6.575,0,0,1-6.236-3.5ZM6.686,20c.538.954,1.027,1.76,2.2,1.76,1.124,0,1.834-.44,1.834-2.15V7.975h3.422V19.658c0,3.543-2.078,5.156-5.11,5.156A5.312,5.312,0,0,1,3.9,21.688Z" style="fill:#f5de19"/></svg>
</span> index.js
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">WebhookClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dialogflow-fulfillment&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">dialogflowWebhook</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">(</span><span class="kr">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">agent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebhookClient</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">queryResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">async</span> <span class="kd">function</span> <span class="nx">userOnboardingHandler</span><span class="p">(</span><span class="nx">agent</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">// Do backend stuff here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">firestore</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">     <span class="kr">const</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">doc</span><span class="p">(</span><span class="s1">&#39;jeffd23&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="kr">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">color</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">parameters</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kr">await</span> <span class="nx">profile</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">color</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="nx">agent</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="sb">`Welcome aboard my friend!`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">intentMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">intentMap</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;UserOnboarding&#39;</span><span class="p">,</span> <span class="nx">userOnboardingHandler</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">agent</span><span class="p">.</span><span class="nx">handleRequest</span><span class="p">(</span><span class="nx">intentMap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><h2 id="part-3-frontend-angular-integration">Part 3: Frontend Angular Integration</h2>
<p>In this section, we build a user-friendly chat UI to interact with the bot. We can quickly build this feature with the <a href="https://akveo.github.io/nebular/">Nebular theme</a> and Angular&rsquo;s HTTP client.</p>
<h3 id="initial-setup">Initial Setup</h3>
<p>Install <a href="https://akveo.github.io/nebular/docs/components/chat-ui/overview#nbchatcomponent">Nebular</a> and import Angular&rsquo;s HTTP Client in your app.</p>


<div class="file-name">
  <span class="file-icon"><svg aria-hidden="true" data-prefix="fas" data-icon="terminal" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svgterminal  "><path fill="currentColor" d="M257.981 272.971L63.638 467.314c-9.373 9.373-24.569 9.373-33.941 0L7.029 444.647c-9.357-9.357-9.375-24.522-.04-33.901L161.011 256 6.99 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L257.981 239.03c9.373 9.372 9.373 24.568 0 33.941zM640 456v-32c0-13.255-10.745-24-24-24H312c-13.255 0-24 10.745-24 24v32c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24z" ></path></svg></span> command line
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ng new my-app --routing
</span></span><span class="line"><span class="cl">cd my-app
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ng add @nebular/theme
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ng generate component chatbot
</span></span></code></pre></div><p>The app module should look something like this:</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_ng_component_ts</title><path d="M2.73,6.67,15.85,2V30L4.77,23.88Z" style="fill:#de3641"/><path d="M15.85,2,29.27,6.59,27.08,23.8,15.85,30Z" style="fill:#b13138"/><path d="M15.85,5.14l8.53,18.23H21.47l-1.82-4.16h-3.8V16.73h2.77L15.85,11l-2.33,5.73h2.33v2.48H12.38l-1.63,4.16H7.61Z" style="fill:#fff"/><path d="M27.41,19.65a2.81,2.81,0,0,1,1.41.81,3.72,3.72,0,0,1,.54.72s-1,.69-1.57,1.06a.5.5,0,0,1-.2-.22,1.28,1.28,0,0,0-1.06-.64.92.92,0,0,0-1.12.91.83.83,0,0,0,.1.42,2.23,2.23,0,0,0,1.31.88c1.62.7,2.31,1.16,2.74,1.81a3.28,3.28,0,0,1,.26,2.76A3,3,0,0,1,27.31,30a6.93,6.93,0,0,1-1.72,0,4.15,4.15,0,0,1-2.3-1.2,4,4,0,0,1-.59-.87l.21-.13.84-.48.65-.38.14.2a3,3,0,0,0,.86.82,2.1,2.1,0,0,0,2.2-.11,1,1,0,0,0,.13-1.25,3.72,3.72,0,0,0-1.55-.9A5.6,5.6,0,0,1,24,24.32a3,3,0,0,1-.62-1.13,4.53,4.53,0,0,1,0-1.44A2.76,2.76,0,0,1,25.7,19.6,5.73,5.73,0,0,1,27.41,19.65Zm-5.31.94v.93H19.16v8.36H17.08V21.52H14.14v-.91a8.9,8.9,0,0,1,0-.93h8v.92Z" style="fill:#007acc"/></svg></span> app.module.ts
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/platform-browser&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpClientModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">AppRoutingModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./app-routing.module&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">AppComponent</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./app.component&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserAnimationsModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/platform-browser/animations&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">NbThemeModule</span><span class="p">,</span> <span class="nx">NbLayoutModule</span><span class="p">,</span> <span class="nx">NbChatModule</span><span class="p">,</span> <span class="nx">NbSpinnerModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@nebular/theme&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">NbEvaIconsModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@nebular/eva-icons&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ChatbotComponent</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./chatbot/chatbot.component&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@NgModule</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AppComponent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ChatbotComponent</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="nx">BrowserModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AppRoutingModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">HttpClientModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">BrowserAnimationsModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">NbThemeModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span> <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">NbLayoutModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">NbEvaIconsModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">NbChatModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">NbSpinnerModule</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providers</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{</span> <span class="p">}</span>
</span></span></code></pre></div><h3 id="chatbot-component">Chatbot Component</h3>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_ng_component_ts</title><path d="M2.73,6.67,15.85,2V30L4.77,23.88Z" style="fill:#de3641"/><path d="M15.85,2,29.27,6.59,27.08,23.8,15.85,30Z" style="fill:#b13138"/><path d="M15.85,5.14l8.53,18.23H21.47l-1.82-4.16h-3.8V16.73h2.77L15.85,11l-2.33,5.73h2.33v2.48H12.38l-1.63,4.16H7.61Z" style="fill:#fff"/><path d="M27.41,19.65a2.81,2.81,0,0,1,1.41.81,3.72,3.72,0,0,1,.54.72s-1,.69-1.57,1.06a.5.5,0,0,1-.2-.22,1.28,1.28,0,0,0-1.06-.64.92.92,0,0,0-1.12.91.83.83,0,0,0,.1.42,2.23,2.23,0,0,0,1.31.88c1.62.7,2.31,1.16,2.74,1.81a3.28,3.28,0,0,1,.26,2.76A3,3,0,0,1,27.31,30a6.93,6.93,0,0,1-1.72,0,4.15,4.15,0,0,1-2.3-1.2,4,4,0,0,1-.59-.87l.21-.13.84-.48.65-.38.14.2a3,3,0,0,0,.86.82,2.1,2.1,0,0,0,2.2-.11,1,1,0,0,0,.13-1.25,3.72,3.72,0,0,0-1.55-.9A5.6,5.6,0,0,1,24,24.32a3,3,0,0,1-.62-1.13,4.53,4.53,0,0,1,0-1.44A2.76,2.76,0,0,1,25.7,19.6,5.73,5.73,0,0,1,27.41,19.65Zm-5.31.94v.93H19.16v8.36H17.08V21.52H14.14v-.91a8.9,8.9,0,0,1,0-.93h8v.92Z" style="fill:#007acc"/></svg></span> chatbot.component.ts
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpClient</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">dialogflowURL</span> <span class="o">=</span> <span class="s1">&#39;https://YOUR-CLOUDFUNCTION/dialogflowGateway&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-chatbot&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./chatbot.component.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./chatbot.component.scss&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">ChatbotComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">messages</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// Random ID to maintain session with server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">sessionId</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">http</span>: <span class="kt">HttpClient</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">addBotMessage</span><span class="p">(</span><span class="s1">&#39;Human presence detected ü§ñ. How can I help you? &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">handleUserMessage</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">addUserMessage</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Make the request 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">dialogflowURL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sessionId</span>: <span class="kt">this.sessionId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">queryInput</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">languageCode</span><span class="o">:</span> <span class="s1">&#39;en-US&#39;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="p">{</span> <span class="nx">fulfillmentText</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">res</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">addBotMessage</span><span class="p">(</span><span class="nx">fulfillmentText</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">addUserMessage</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sender</span><span class="o">:</span> <span class="s1">&#39;You&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">reply</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">date</span>: <span class="kt">new</span> <span class="nb">Date</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">addBotMessage</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sender</span><span class="o">:</span> <span class="s1">&#39;Bot&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">avatar</span><span class="o">:</span> <span class="s1">&#39;/assets/bot.jpeg&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">date</span>: <span class="kt">new</span> <span class="nb">Date</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="chatbot-template">Chatbot Template</h3>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_html</title><polygon points="5.902 27.201 3.655 2 28.345 2 26.095 27.197 15.985 30 5.902 27.201" style="fill:#e44f26"/><polygon points="16 27.858 24.17 25.593 26.092 4.061 16 4.061 16 27.858" style="fill:#f1662a"/><polygon points="16 13.407 11.91 13.407 11.628 10.242 16 10.242 16 7.151 15.989 7.151 8.25 7.151 8.324 7.981 9.083 16.498 16 16.498 16 13.407" style="fill:#ebebeb"/><polygon points="16 21.434 15.986 21.438 12.544 20.509 12.324 18.044 10.651 18.044 9.221 18.044 9.654 22.896 15.986 24.654 16 24.65 16 21.434" style="fill:#ebebeb"/><polygon points="15.989 13.407 15.989 16.498 19.795 16.498 19.437 20.507 15.989 21.437 15.989 24.653 22.326 22.896 22.372 22.374 23.098 14.237 23.174 13.407 22.341 13.407 15.989 13.407" style="fill:#fff"/><polygon points="15.989 7.151 15.989 9.071 15.989 10.235 15.989 10.242 23.445 10.242 23.445 10.242 23.455 10.242 23.517 9.548 23.658 7.981 23.732 7.151 15.989 7.151" style="fill:#fff"/></svg></span> chatbot.component.html
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">nb-chat</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;Conversation with a Bot&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nb-chat-message</span> <span class="err">*</span><span class="na">ngFor</span><span class="o">=</span><span class="s">&#34;let msg of messages&#34;</span>
</span></span><span class="line"><span class="cl">                     <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
</span></span><span class="line"><span class="cl">                     <span class="err">[</span><span class="na">message</span><span class="err">]=&#34;</span><span class="na">msg</span><span class="err">.</span><span class="na">text</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">                     <span class="err">[</span><span class="na">reply</span><span class="err">]=&#34;</span><span class="na">msg</span><span class="err">.</span><span class="na">reply</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">                     <span class="err">[</span><span class="na">sender</span><span class="err">]=&#34;</span><span class="na">msg</span><span class="err">.</span><span class="na">sender</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">                     <span class="err">[</span><span class="na">date</span><span class="err">]=&#34;</span><span class="na">msg</span><span class="err">.</span><span class="na">date</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">                     <span class="err">[</span><span class="na">avatar</span><span class="err">]=&#34;</span><span class="na">msg</span><span class="err">.</span><span class="na">avatar</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">nb-chat-message</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">nb-chat-message</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&#34;loading&#34;</span> <span class="err">[</span><span class="na">nbSpinner</span><span class="err">]=&#34;</span><span class="na">loading</span><span class="err">&#34;</span> <span class="na">nbSpinnerStatus</span><span class="o">=</span><span class="s">&#34;info&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">avatar</span><span class="o">=</span><span class="s">&#34;/assets/bot.jpeg&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">message</span><span class="o">=</span><span class="s">&#34;...&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">nb-chat-message</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nb-chat-form</span> <span class="err">(</span><span class="na">send</span><span class="err">)=&#34;</span><span class="na">handleUserMessage</span><span class="err">($</span><span class="na">event</span><span class="err">)&#34;</span> <span class="err">[</span><span class="na">dropFiles</span><span class="err">]=&#34;</span><span class="na">true</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">nb-chat-form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">nb-chat</span><span class="p">&gt;</span>
</span></span></code></pre></div>

				
			</section>

			<section id="qna" class="my-12 flex flex-col justify-between items-center">
    <h2 class="text-2xl mb-4">Questions? Let's chat</h2>
    <a href="https://discord.gg/SpDdJ3qaKK" class="btn btn-purple btn-lg btn-glow btn-display mx-auto"><span class="w-8 mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></span> Open Discord</a>
    <div class="mt-3">
        <discord-count></discord-count>
    </div>
</section>

		</article>
		
		
		<aside class="tableOfContents">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#part-1-create-a-chatbot">Part 1: Create a Chatbot</a>
      <ul>
        <li><a href="#create-an-agent">Create an Agent</a></li>
        <li><a href="#create-an-intent">Create an Intent</a></li>
        <li><a href="#actions-and-parameters">Actions and Parameters</a></li>
        <li><a href="#responses-and-fulfillment">Responses and Fulfillment</a></li>
      </ul>
    </li>
    <li><a href="#part-2-backend-cloud-functions">Part 2: Backend Cloud Functions</a>
      <ul>
        <li><a href="#add-your-service-account">Add your Service Account</a></li>
        <li><a href="#handling-conversations">Handling Conversations</a></li>
        <li><a href="#fulfilling-intents-with-a-webhook">Fulfilling Intents with a Webhook</a></li>
      </ul>
    </li>
    <li><a href="#part-3-frontend-angular-integration">Part 3: Frontend Angular Integration</a>
      <ul>
        <li><a href="#initial-setup">Initial Setup</a></li>
        <li><a href="#chatbot-component">Chatbot Component</a></li>
        <li><a href="#chatbot-template">Chatbot Template</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		
	</div>


</main>

    
<footer class="container text-center my-6 p-8 text-gray3">
    <div class="mx-auto w-24 h-1 my-12 bg-gradient-to-r from-gray5 to-gray4 rounded-full"></div>
    <div class="pt-10">Find an issue with this page? <a class="text-blue-500" href="https://github.com/k0deville/k0deville.github.io">Fix it on GitHub</a></div>

    <div class="py-3">
        Need help? Email <a href="mailto:kodeville97@gmail.com"><strong class="text-white font-bold">kodeville97@gmail.com</strong></a>
    </div>
    <div class="flex justify-center items-center my-2">
        <a href="https://www.youtube.com/c/Kodeville"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svgyoutube  "><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" ></path></svg></i></a>
        <a href="https://twitter.com/Kodeville_dev"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svgtwitter  "><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" ></path></svg></i></a>
        <a href="https://github.com/Kodeville-io"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svggithub "><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" ></path></svg></i></a>
        <a href="https://discord.gg/SpDdJ3qaKK"><i class="w-6 inline-block mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></i></a>
    </div>

    <h6>Helpful Links</h6>

    <div class="py-3">
        <a href="../../courses/index.html">Courses</a> | 
        <a href="../index.html">Labs</a> | 
        <a href="../../snippets/index.html">Snippets</a> | 
        <a href="../../tags/index.html">Tags</a> | 
        <a href="../../contributors/index.html">Contrib</a> |
        <a href="../../privacy/index.html">Privacy</a> | 
        <a href="../../terms/index.html">Terms</a>
    </div>

    
    <div class="text-xs">
        Copyright 2023 KodeVille Pvt Ltd<br> 
    </div>

</footer>




    <app-signin></app-signin>
    <algolia-search></algolia-search>
    <hi-mom></hi-mom>

    <email-handler></email-handler>

    <route-loader>
      <div class="fixed w-full top-0 left-0 h-1 gradient-loader"></div>
    </route-loader>

    <toast-message></toast-message>
    <scroll-up></scroll-up>

    </div>

  </body>

<!-- Mirrored from Kodeville.io/lessons/build-a-chatbot-with-dialogflow/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:07:22 GMT -->
</html>