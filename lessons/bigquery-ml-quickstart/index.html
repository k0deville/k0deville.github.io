<!DOCTYPE html>
<html class="dark">
  
<!-- Mirrored from Kodeville.io/lessons/bigquery-ml-quickstart/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:09:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>BigQuery ML Quickstart</title>
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../../svelte/index.be288b01.css" />
    <script type="module" defer src="../../svelte/index.3d7fd5b5.js" /></script>

    
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="../../img/favicon.png" />
    <meta name="theme-color" content="#454e56">
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <link rel="manifest" href="../../manifest.json">
    

 




    <link rel="canonical" href="index.html" />

    <meta name="description" content="Use BigQuery to process massive amounts of data for analysis and machine learning.">
    <meta name="image" content="https://Kodeville.io/lessons/bigquery-ml-quickstart/img/featured.png">

    <meta property="og:title" content="BigQuery ML Quickstart" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://Kodeville.io/lessons/bigquery-ml-quickstart/" />
    <meta property="og:image" content="https://Kodeville.io/lessons/bigquery-ml-quickstart/img/featured.png" />
    <meta property="og:description" content="Use BigQuery to process massive amounts of data for analysis and machine learning." />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Kodeville_dev">
    <meta name="twitter:title" content="BigQuery ML Quickstart">
    <meta name="twitter:description" content="Use BigQuery to process massive amounts of data for analysis and machine learning.">
    <meta name="twitter:image" content="https://Kodeville.io/lessons/bigquery-ml-quickstart/img/featured.png">
    
    <script>
      if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
              navigator.serviceWorker.register('../../sw.js');
          });
      }
    </script>

  </head>
  <body>
    <global-data 
    permalink="https://Kodeville.io/lessons/bigquery-ml-quickstart/" 
    vimeo=""
    youtube="ajTp60neMlc"
    free=""
    next="https://Kodeville.io/lessons/flutter-state-management-guide/" 
    prev="https://Kodeville.io/lessons/flutter-slider-like-reflectly/">
  </global-data>

    
<nav class="flex justify-between container p-6 md:p-8">
  <a
    class="flex justify-center items-center text-center w-12 h-12 logo-gif"
    href="../../index.html"
  >
    <img id="logo" src="../../img/logo.svg" alt="logo" />
    <img class="relative bottom-1 left-1" id="logoBg" src="../../img/fire.gif" alt="fire background" />
  </a>

  <ul class="flex justify-center items-center">
    <if-pro>
      <li slot="basic" class="mx-2 md:mx-4  hover:scale-105 transition-transform">
        <a href="../../pro/index.html" class="font-display text-base font-normal text-green-500 border-green-400 border rounded-md px-2 py-1 hover:drop-shadow-[0_0_9px_rgba(34,197,94,0.9)]">PRO</a>
      </li>
    </if-pro>
    <li class="mx-2 md:mx-4 hover:scale-105 transition-transform">
      <a href="../index.html" class="font-sans text-xl font-bold leading-none text-gray2 hover:text-white">labs</a>
    </li>
    <li class="mx-2 md:mx-4  hover:scale-105 transition-transform">
      <a href="../../courses/index.html" class="font-sans text-xl font-bold leading-none text-gray2 gradient-slide">courses</a>
    </li>
    <li class="ml-2">
      <modal-action type="open" name="search">
        <button class="p-2 mr-2 hidden md:flex justify-between items-center bg-white bg-opacity-10 hover:bg-opacity-20 border border-gray4 hover:border-purple-500 
                 shadow-xl hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all">
          <span class="text-gray2 w-4 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
          <span class="mr-12">Search</span>
          <span class="mx-2 text-xs border border-gray4 rounded-md p-1 px-2">/</span>
        </button>
        <button class="flex md:hidden">
          <span class="text-gray2 w-6 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
        </button>
        </modal-action>
      </li>
    <li class="ml-2 mr-6 relative">
      <if-user>
        <a href="../../dashboard/index.html">
          <user-avatar></user-avatar>
        </a>
        <modal-action slot="signed-out" name="signin" type="open">
          <button class="relative hidden md:inline-block px-4 py-2 text-xl font-display text-black hover:text-white bg-white 
                hover:bg-purple-600 drop-shadow-[6px_6px_0_black] hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all duration-300">
            login
          </button>
          <button class="flex md:hidden">
            <span class="text-gray2 w-6 mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M352 96h64c17.7 0 32 14.3 32 32V384c0 17.7-14.3 32-32 32H352c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c53 0 96-43 96-96V128c0-53-43-96-96-96H352c-17.7 0-32 14.3-32 32s14.3 32 32 32zm-7.5 177.4c4.8-4.5 7.5-10.8 7.5-17.4s-2.7-12.9-7.5-17.4l-144-136c-7-6.6-17.2-8.4-26-4.6s-14.5 12.5-14.5 22v72H32c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32H160v72c0 9.6 5.7 18.2 14.5 22s19 2 26-4.6l144-136z"/></svg>
</span>
          </button>
        </modal-action>
      </if-user>
    </li>


  </ul>
</nav>


    
<main class="container">


	<div class="flex w-full justify-between">


		<article itemscope itemtype="http://schema.org/Article" class="w-full">
			<meta itemprop="datePublished" content="2019-03-13 18:23:18 -0700 -0700" />
			<meta itemprop="dateModified" content="2019-03-13 18:23:18 -0700 -0700" />
			<meta itemprop="image" content="img/featured.png" />
			<meta itemprop="publisher" content="Kodeville.io" />


			<header>

				
				
				<div itemprop="video" itemscope itemtype="http://schema.org/VideoObject">
					<iframe class="w-full aspect-video" src="https://www.youtube.com/embed/ajTp60neMlc"
						frameborder="0"
						allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen></iframe>

					<meta itemprop="embedUrl" content="https://www.youtube.com/embed/ajTp60neMlc" />
					<meta itemprop="thumbnailUrl" content="" />
					<meta itemprop="description" content="Use BigQuery to process massive amounts of data for analysis and machine learning." />
					<meta itemprop="uploadDate" content="2019-03-13 18:23:18 -0700 -0700" />
					<meta itemprop="publisher" content="Kodeville" />
				</div>
				

				

				<div class="bg-gray6 py-5 px-3 rounded-lg mb-4 flex justify-between mt-3">

					
					
					<a class="flex items-center no-underline" itemprop="author" name="Jeff Delaney" href="../../contributors/jeff-delaney/index.html">
						<img class="w-10 h-10 rounded-full block" src="../../contributors/img/jeff-delaney.webp" alt="Jeff Delaney avatar">
						<span class="flex flex-col ml-2">
							<span class="no-underline">By Jeff Delaney</span>
							<span class="text-xs text-gray4">Posted <time itemprop="dateModified">Mar 13, 2019</time>
						</span>
	
					</a>

					
					<span>
						
							<a href="../../tags/machine-learning/index.html"><span class="tag tag-machine-learning">#machine-learning</span></a>
						
							<a href="../../tags/big-query/index.html"><span class="tag tag-big-query">#big-query</span></a>
						
							<a href="../../tags/sql/index.html"><span class="tag tag-sql">#sql</span></a>
						
							<a href="../../tags/python/index.html"><span class="tag tag-python">#python</span></a>
						

						
					</span>
					
				
				</div>

			</header>



			
			<section class="prose dark:prose-invert max-w-full lesson-content" itemprop="articleBody">
				


				<h1 itemprop="name headline" id="bigquery-ml-quickstart" class="gradient-text">
					BigQuery ML Quickstart
				</h1>


				<p><a href="https://cloud.google.com/bigquery/">BigQuery</a> is a serverless <a href="https://en.wikipedia.org/wiki/Data_warehouse">Data Warehouse</a> that makes it easy to process and query massive amounts of data. It supports standard SQL queries in a web-based UI, via the command line, or with a variety of client libraries. In addition, it recently landed support for integrated machine learning, allowing you to build predictive models without data science skills.</p>
<p><strong>What can you do with Big Query?</strong></p>
<ul>
<li>Stream data to business intelligence tools like Data Studio, Tableau, etc.</li>
<li>Combine Web Analytics with iOS/Android on Firebase.</li>
<li>Organize and connect multiple data sources.</li>
<li>Build a horse racing machine learning model 🏇</li>
</ul>
<p>In the following lesson, we will harness the data-crunching power of 👾 BigQueryML, along with DataStudio and DataLab, to build a predictive model from historical Horse Racing Data. Our goal is to turn this dataset into an ML model.</p>
<h2 id="import-data-into-big-query">Import Data into Big Query</h2>
<p>The first step is to import your data into BigQuery. Create a new Google Cloud Platform or Firebase project, then navigate to the <a href="https://console.cloud.google.com/bigquery">BigQuery Web UI</a>.</p>
<h3 id="upload-data-to-cloud-storage">Upload Data to Cloud Storage</h3>
<p>Download the <a href="https://www.kaggle.com/lukebyrne/horses-for-courses">Horse Racing Dataset</a> from Kaggle, specifically the <em>horses.csv</em> file. Because this file is larger than 10Mb, we need to first upload it to a GCP storage bucket.</p>
<figure><img src="img/bigquery-upload-data.png"
         alt="Upload horses.csv to a cloud storage bucket"/><figcaption>
            <p>Upload horses.csv to a cloud storage bucket</p>
        </figcaption>
</figure>

<h3 id="create-a-dataset--table">Create a Dataset &amp; Table</h3>
<p>Click on the <strong>+ Add Data</strong> button and make sure your project is pinned, then click on <strong>Create Dataset</strong>. Provide a name and use the default options.</p>
<figure><img src="img/bigquery-console.png"
         alt="The big query web UI"/><figcaption>
            <p>The big query web UI</p>
        </figcaption>
</figure>

<p>Now that you have a dataset, you can start adding tables to it. Tables represent data that you query using SQL. You can define your own schema manually, but BigQuery can autodetect the schema of CSV files based on the header row and a random sample of rows. Click <strong>Create Table</strong> and reference the data in the storage bucket with the following options.</p>
<p><figure><img src="img/bigquery-create-table.png"/>
</figure>

<figure><img src="img/bigquery-create-table2.png"
         alt="Follow these configuration options closely. Set the schema to auto-detect and the &amp;lsquo;Header rows to skip&amp;rsquo; to 1 under the advanced tab"/><figcaption>
            <p>Follow these configuration options closely. Set the schema to auto-detect and the &lsquo;Header rows to skip&rsquo; to 1 under the advanced tab</p>
        </figcaption>
</figure>
</p>
<h3 id="make-your-first-query">Make your First Query</h3>
<p>The end result should be a table that looks just like the original spreadsheet. Enter a <a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/query-syntax">Standard SQL Query</a> in the console to try it out. In this dataset, the <em>position</em> value represents a horse&rsquo;s finishing position in a race, which is what we want to predict.</p>
<figure><img src="img/bigquery-schema.png"/>
</figure>



<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_sql</title><path d="M8.562,15.256A21.159,21.159,0,0,0,16,16.449a21.159,21.159,0,0,0,7.438-1.194c1.864-.727,2.525-1.535,2.525-2V9.7a10.357,10.357,0,0,1-2.084,1.076A22.293,22.293,0,0,1,16,12.078a22.36,22.36,0,0,1-7.879-1.3A10.28,10.28,0,0,1,6.037,9.7v3.55C6.037,13.724,6.7,14.528,8.562,15.256Z" style="fill:#ffda44"/><path d="M8.562,21.961a15.611,15.611,0,0,0,2.6.741A24.9,24.9,0,0,0,16,23.155a24.9,24.9,0,0,0,4.838-.452,15.614,15.614,0,0,0,2.6-.741c1.864-.727,2.525-1.535,2.525-2v-3.39a10.706,10.706,0,0,1-1.692.825A23.49,23.49,0,0,1,16,18.74a23.49,23.49,0,0,1-8.271-1.348,10.829,10.829,0,0,1-1.692-.825V19.96C6.037,20.426,6.7,21.231,8.562,21.961Z" style="fill:#ffda44"/><path d="M16,30c5.5,0,9.963-1.744,9.963-3.894V23.269a10.5,10.5,0,0,1-1.535.762l-.157.063A23.487,23.487,0,0,1,16,25.445a23.422,23.422,0,0,1-8.271-1.351c-.054-.02-.106-.043-.157-.063a10.5,10.5,0,0,1-1.535-.762v2.837C6.037,28.256,10.5,30,16,30Z" style="fill:#ffda44"/><ellipse cx="16" cy="5.894" rx="9.963" ry="3.894" style="fill:#ffda44"/></svg></span> 
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">Kodeville</span><span class="o">-</span><span class="n">lessons</span><span class="p">.</span><span class="n">horse_data</span><span class="p">.</span><span class="n">horses</span><span class="o">`</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1000</span><span class="w">
</span></span></span></code></pre></div><p>If the data looks malformatted at this point, you may need to open horses.csv in MS Excel and manually convert the number columns to numbers. BigQuery will error out if mismatched datatypes are present in the data.</p>
<h3 id="optional-analyze-in-data-studio">Optional: Analyze in Data Studio</h3>
<p>Make a query, then click <strong>Export -&gt; Explore in Data Studio</strong>. A solid ML algorithm typically starts off with a thorough exploratory analysis. DataStudio will help you visualize the dataset and create custom charts.</p>
<figure><img src="img/bigquery-datastudio.png"/>
</figure>

<h2 id="create-a-predictive-ml-model">Create a Predictive ML Model</h2>
<p>Now we&rsquo;re ready for the fun part - converting our horse racing data into a predictive ML model. We will use another GCP service called <a href="https://cloud.google.com/datalab/">DataLab</a>, which connects a cloud VM to a Python notebook, along with a connection to your BigQuery dataset. In other words, it puts unlimited compute resources at your fingertips for training ML models on your data.</p>
<p>The DataLab instance will accrue costs. Make sure to delete the VM from the compute tab and any other resources after you are finished with this tutorial.</p>
<h3 id="open-a-cloud-shell">Open a Cloud Shell</h3>
<p>Click on the <strong>Activate Cloud Shell</strong> button in the top right next your profile image. This opens a shell session that we can use to launch a DataLab instance.</p>
<figure><img src="img/bigquery-shell.png"/>
</figure>

<p>Enter the <code>datalab create horsemagic</code> command and follow the steps it gives you, which will result in an SSH tunnel on port 8081.</p>
<figure><img src="img/bigquery-shell2.png"
         alt="Open the web preview, but make sure to change the port to 8081"/><figcaption>
            <p>Open the web preview, but make sure to change the port to 8081</p>
        </figcaption>
</figure>

<h3 id="access-bigquery-from-datalab">Access BigQuery from DataLab</h3>
<p>Your BigQuery data is automatically available in the DataLab notebook. Create a new notebook, then get familiar with the available commands by running <code>%% bq -h</code>.</p>
<figure><img src="img/bigquery-datalab.png"
         alt="Run &amp;lsquo;%%bq tables list&amp;rsquo; and you should see the table we created in BigQuery"/><figcaption>
            <p>Run &lsquo;%%bq tables list&rsquo; and you should see the table we created in BigQuery</p>
        </figcaption>
</figure>

<h3 id="create-a-model">Create a Model</h3>
<p>Create a new cell in the notebook and run the code below, but make sure to use your own table names. Our goal is to predict the <em>position</em> label. This is a <a href="https://math.stackexchange.com/questions/141381/regression-vs-classification">classification</a> problem, so we use <em>logistic_reg</em> as the model type, then select the columns we think will result in the best predictions - feel free to change these and experiment. Reference the <a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/bigqueryml-syntax-create">CREATE MODEL</a> statement docs for additional BigQueryML options.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32"><defs><linearGradient id="a" x1="-133.268" y1="-202.91" x2="-133.198" y2="-202.84" gradientTransform="translate(25243.061 38519.17) scale(189.38 189.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#387eb8"/><stop offset="1" stop-color="#366994"/></linearGradient><linearGradient id="b" x1="-133.575" y1="-203.203" x2="-133.495" y2="-203.133" gradientTransform="translate(25309.061 38583.42) scale(189.38 189.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ffe052"/><stop offset="1" stop-color="#ffc331"/></linearGradient></defs><title>file_type_python</title><path d="M15.885,2.1c-7.1,0-6.651,3.07-6.651,3.07V8.36h6.752v1H6.545S2,8.8,2,16.005s4.013,6.912,4.013,6.912H8.33V19.556s-.13-4.013,3.9-4.013h6.762s3.772.06,3.772-3.652V5.8s.572-3.712-6.842-3.712h0ZM12.153,4.237a1.214,1.214,0,1,1-1.183,1.244v-.02a1.214,1.214,0,0,1,1.214-1.214h0Z" style="fill:url(#a)"/><path d="M16.085,29.91c7.1,0,6.651-3.08,6.651-3.08V23.65H15.985v-1h9.47S30,23.158,30,15.995s-4.013-6.912-4.013-6.912H23.64V12.4s.13,4.013-3.9,4.013H12.975S9.2,16.356,9.2,20.068V26.2s-.572,3.712,6.842,3.712h.04Zm3.732-2.147A1.214,1.214,0,1,1,21,26.519v.03a1.214,1.214,0,0,1-1.214,1.214h.03Z" style="fill:url(#b)"/></svg></span> notebook
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span>
</span></span><span class="line"><span class="cl"><span class="n">CREATE</span> <span class="n">OR</span> <span class="n">REPLACE</span> <span class="n">MODEL</span> <span class="err">`</span><span class="n">Kodeville</span><span class="o">-</span><span class="n">lessons</span><span class="o">.</span><span class="n">horse_data</span><span class="o">.</span><span class="n">ml_model</span><span class="err">`</span>
</span></span><span class="line"><span class="cl"><span class="n">OPTIONS</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;logistic_reg&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">input_label_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span> <span class="n">AS</span>
</span></span><span class="line"><span class="cl"><span class="n">SELECT</span>
</span></span><span class="line"><span class="cl">  <span class="n">age</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">sex</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">overall_wins</span><span class="p">,</span> <span class="n">overall_places</span><span class="p">,</span> <span class="n">handicap_weight</span><span class="p">,</span> <span class="n">penalty</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="n">favourite_odds_win</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">runner_id</span><span class="p">,</span> <span class="n">bf_odds</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">market_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">position</span>
</span></span><span class="line"><span class="cl"><span class="n">FROM</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="n">Kodeville</span><span class="o">-</span><span class="n">lessons</span><span class="o">.</span><span class="n">horse_data</span><span class="o">.</span><span class="n">horses</span><span class="err">`</span>
</span></span></code></pre></div><figure><img src="img/bigquery-ml-model.png"
         alt="This will take a few minutes, then the ML model should appear in the BigQuery dataset"/><figcaption>
            <p>This will take a few minutes, then the ML model should appear in the BigQuery dataset</p>
        </figcaption>
</figure>

<h3 id="evaluate-performance-and-predict">Evaluate Performance and Predict</h3>
<p>For this particular ML problem, we are interested in the <em>log_loss</em> metric - a smaller value is better.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32"><defs><linearGradient id="a" x1="-133.268" y1="-202.91" x2="-133.198" y2="-202.84" gradientTransform="translate(25243.061 38519.17) scale(189.38 189.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#387eb8"/><stop offset="1" stop-color="#366994"/></linearGradient><linearGradient id="b" x1="-133.575" y1="-203.203" x2="-133.495" y2="-203.133" gradientTransform="translate(25309.061 38583.42) scale(189.38 189.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ffe052"/><stop offset="1" stop-color="#ffc331"/></linearGradient></defs><title>file_type_python</title><path d="M15.885,2.1c-7.1,0-6.651,3.07-6.651,3.07V8.36h6.752v1H6.545S2,8.8,2,16.005s4.013,6.912,4.013,6.912H8.33V19.556s-.13-4.013,3.9-4.013h6.762s3.772.06,3.772-3.652V5.8s.572-3.712-6.842-3.712h0ZM12.153,4.237a1.214,1.214,0,1,1-1.183,1.244v-.02a1.214,1.214,0,0,1,1.214-1.214h0Z" style="fill:url(#a)"/><path d="M16.085,29.91c7.1,0,6.651-3.08,6.651-3.08V23.65H15.985v-1h9.47S30,23.158,30,15.995s-4.013-6.912-4.013-6.912H23.64V12.4s.13,4.013-3.9,4.013H12.975S9.2,16.356,9.2,20.068V26.2s-.572,3.712,6.842,3.712h.04Zm3.732-2.147A1.214,1.214,0,1,1,21,26.519v.03a1.214,1.214,0,0,1-1.214,1.214h.03Z" style="fill:url(#b)"/></svg></span> notebook
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span>
</span></span><span class="line"><span class="cl"><span class="n">SELECT</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">FROM</span>
</span></span><span class="line"><span class="cl">  <span class="n">ML</span><span class="o">.</span><span class="n">EVALUATE</span><span class="p">(</span><span class="n">MODEL</span> <span class="err">`</span><span class="n">Kodeville</span><span class="o">-</span><span class="n">lessons</span><span class="o">.</span><span class="n">horse_data</span><span class="o">.</span><span class="n">ml_model</span><span class="err">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">SELECT</span>
</span></span><span class="line"><span class="cl">        <span class="n">age</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">sex</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">overall_wins</span><span class="p">,</span> <span class="n">overall_places</span><span class="p">,</span> <span class="n">handicap_weight</span><span class="p">,</span> <span class="n">penalty</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">favourite_odds_win</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">runner_id</span><span class="p">,</span> <span class="n">bf_odds</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">market_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">position</span>
</span></span><span class="line"><span class="cl">      <span class="n">FROM</span>
</span></span><span class="line"><span class="cl">        <span class="err">`</span><span class="n">Kodeville</span><span class="o">-</span><span class="n">lessons</span><span class="o">.</span><span class="n">horse_data</span><span class="o">.</span><span class="n">horses</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><figure><img src="img/bigquery-ml-results.png"/>
</figure>

<p>At this point, we&rsquo;re happy with our model and it should pick the right winner for every horse race, therefore making us extremely wealthy 🤑. To make predictions, we can add new tables to our database with the same schema, then use the ML.PREDICT statement. In this example, I am just taking 10 random samples from the existing data.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32"><defs><linearGradient id="a" x1="-133.268" y1="-202.91" x2="-133.198" y2="-202.84" gradientTransform="translate(25243.061 38519.17) scale(189.38 189.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#387eb8"/><stop offset="1" stop-color="#366994"/></linearGradient><linearGradient id="b" x1="-133.575" y1="-203.203" x2="-133.495" y2="-203.133" gradientTransform="translate(25309.061 38583.42) scale(189.38 189.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ffe052"/><stop offset="1" stop-color="#ffc331"/></linearGradient></defs><title>file_type_python</title><path d="M15.885,2.1c-7.1,0-6.651,3.07-6.651,3.07V8.36h6.752v1H6.545S2,8.8,2,16.005s4.013,6.912,4.013,6.912H8.33V19.556s-.13-4.013,3.9-4.013h6.762s3.772.06,3.772-3.652V5.8s.572-3.712-6.842-3.712h0ZM12.153,4.237a1.214,1.214,0,1,1-1.183,1.244v-.02a1.214,1.214,0,0,1,1.214-1.214h0Z" style="fill:url(#a)"/><path d="M16.085,29.91c7.1,0,6.651-3.08,6.651-3.08V23.65H15.985v-1h9.47S30,23.158,30,15.995s-4.013-6.912-4.013-6.912H23.64V12.4s.13,4.013-3.9,4.013H12.975S9.2,16.356,9.2,20.068V26.2s-.572,3.712,6.842,3.712h.04Zm3.732-2.147A1.214,1.214,0,1,1,21,26.519v.03a1.214,1.214,0,0,1-1.214,1.214h.03Z" style="fill:url(#b)"/></svg></span> notebook
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span>
</span></span><span class="line"><span class="cl"><span class="n">SELECT</span>
</span></span><span class="line"><span class="cl">  <span class="n">sex</span><span class="p">,</span> <span class="n">runner_id</span><span class="p">,</span> <span class="n">position</span>
</span></span><span class="line"><span class="cl"><span class="n">FROM</span>
</span></span><span class="line"><span class="cl">  <span class="n">ML</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">(</span><span class="n">MODEL</span> <span class="err">`</span><span class="n">Kodeville</span><span class="o">-</span><span class="n">lessons</span><span class="o">.</span><span class="n">horse_data</span><span class="o">.</span><span class="n">ml_model</span><span class="err">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">SELECT</span>
</span></span><span class="line"><span class="cl">          <span class="n">age</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">sex</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">overall_wins</span><span class="p">,</span> <span class="n">overall_places</span><span class="p">,</span> <span class="n">handicap_weight</span><span class="p">,</span> <span class="n">penalty</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="n">favourite_odds_win</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">runner_id</span><span class="p">,</span> <span class="n">bf_odds</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">market_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">position</span>
</span></span><span class="line"><span class="cl">        <span class="n">FROM</span>
</span></span><span class="line"><span class="cl">          <span class="err">`</span><span class="n">Kodeville</span><span class="o">-</span><span class="n">lessons</span><span class="o">.</span><span class="n">horse_data</span><span class="o">.</span><span class="n">horses</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">        <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">RAND</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">LIMIT</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></div><figure><img src="img/bigquery-ml-predict.png"
         alt="The final model predictions that we can take to the racetrack"/><figcaption>
            <p>The final model predictions that we can take to the racetrack</p>
        </figcaption>
</figure>



				
			</section>

			<section id="qna" class="my-12 flex flex-col justify-between items-center">
    <h2 class="text-2xl mb-4">Questions? Let's chat</h2>
    <a href="https://discord.gg/SpDdJ3qaKK" class="btn btn-purple btn-lg btn-glow btn-display mx-auto"><span class="w-8 mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></span> Open Discord</a>
    <div class="mt-3">
        <discord-count></discord-count>
    </div>
</section>

		</article>
		
		
		<aside class="tableOfContents">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#import-data-into-big-query">Import Data into Big Query</a>
      <ul>
        <li><a href="#upload-data-to-cloud-storage">Upload Data to Cloud Storage</a></li>
        <li><a href="#create-a-dataset--table">Create a Dataset &amp; Table</a></li>
        <li><a href="#make-your-first-query">Make your First Query</a></li>
        <li><a href="#optional-analyze-in-data-studio">Optional: Analyze in Data Studio</a></li>
      </ul>
    </li>
    <li><a href="#create-a-predictive-ml-model">Create a Predictive ML Model</a>
      <ul>
        <li><a href="#open-a-cloud-shell">Open a Cloud Shell</a></li>
        <li><a href="#access-bigquery-from-datalab">Access BigQuery from DataLab</a></li>
        <li><a href="#create-a-model">Create a Model</a></li>
        <li><a href="#evaluate-performance-and-predict">Evaluate Performance and Predict</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		
	</div>


</main>

    
<footer class="container text-center my-6 p-8 text-gray3">
    <div class="mx-auto w-24 h-1 my-12 bg-gradient-to-r from-gray5 to-gray4 rounded-full"></div>
    <div class="pt-10">Find an issue with this page? <a class="text-blue-500" href="https://github.com/k0deville/k0deville.github.io">Fix it on GitHub</a></div>

    <div class="py-3">
        Need help? Email <a href="mailto:kodeville97@gmail.com"><strong class="text-white font-bold">kodeville97@gmail.com</strong></a>
    </div>
    <div class="flex justify-center items-center my-2">
        <a href="https://www.youtube.com/c/Kodeville"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svgyoutube  "><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" ></path></svg></i></a>
        <a href="https://twitter.com/Kodeville_dev"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svgtwitter  "><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" ></path></svg></i></a>
        <a href="https://github.com/Kodeville-io"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svggithub "><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" ></path></svg></i></a>
        <a href="https://discord.gg/SpDdJ3qaKK"><i class="w-6 inline-block mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></i></a>
    </div>

    <h6>Helpful Links</h6>

    <div class="py-3">
        <a href="../../courses/index.html">Courses</a> | 
        <a href="../index.html">Labs</a> | 
        <a href="../../snippets/index.html">Snippets</a> | 
        <a href="../../tags/index.html">Tags</a> | 
        <a href="../../contributors/index.html">Contrib</a> |
        <a href="../../privacy/index.html">Privacy</a> | 
        <a href="../../terms/index.html">Terms</a>
    </div>

    
    <div class="text-xs">
        Copyright 2023 KodeVille Pvt Ltd<br> 
    </div>

</footer>




    <app-signin></app-signin>
    <algolia-search></algolia-search>
    <hi-mom></hi-mom>

    <email-handler></email-handler>

    <route-loader>
      <div class="fixed w-full top-0 left-0 h-1 gradient-loader"></div>
    </route-loader>

    <toast-message></toast-message>
    <scroll-up></scroll-up>

    </div>

  </body>

<!-- Mirrored from Kodeville.io/lessons/bigquery-ml-quickstart/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:09:24 GMT -->
</html>