<!DOCTYPE html>
<html class="dark">
  
<!-- Mirrored from Kodeville.io/lessons/flutter-inapp-purchases/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:07:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>In App Purchases in Flutter</title>
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../../svelte/index.be288b01.css" />
    <script type="module" defer src="../../svelte/index.3d7fd5b5.js" /></script>

    
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="../../img/favicon.png" />
    <meta name="theme-color" content="#454e56">
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <link rel="manifest" href="../../manifest.json">
    

 




    <link rel="canonical" href="index.html" />

    <meta name="description" content="Accept In App Purchases and microtransactions in Flutter for digital products on the Apple App Store and Google Play Store.">
    <meta name="image" content="https://Kodeville.io/lessons/flutter-inapp-purchases/img/featured.png">

    <meta property="og:title" content="In App Purchases in Flutter" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://Kodeville.io/lessons/flutter-inapp-purchases/" />
    <meta property="og:image" content="https://Kodeville.io/lessons/flutter-inapp-purchases/img/featured.png" />
    <meta property="og:description" content="Accept In App Purchases and microtransactions in Flutter for digital products on the Apple App Store and Google Play Store." />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Kodeville_dev">
    <meta name="twitter:title" content="In App Purchases in Flutter">
    <meta name="twitter:description" content="Accept In App Purchases and microtransactions in Flutter for digital products on the Apple App Store and Google Play Store.">
    <meta name="twitter:image" content="https://Kodeville.io/lessons/flutter-inapp-purchases/img/featured.png">
    
    <script>
      if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
              navigator.serviceWorker.register('../../sw.js');
          });
      }
    </script>

  </head>
  <body>
    <global-data 
    permalink="https://Kodeville.io/lessons/flutter-inapp-purchases/" 
    vimeo=""
    youtube="NWbkKH-2xcQ"
    free=""
    next="https://Kodeville.io/lessons/paypal-checkout-frontend/" 
    prev="https://Kodeville.io/lessons/sendgrid-transactional-email-guide/">
  </global-data>

    
<nav class="flex justify-between container p-6 md:p-8">
  <a
    class="flex justify-center items-center text-center w-12 h-12 logo-gif"
    href="../../index.html"
  >
    <img id="logo" src="../../img/logo.svg" alt="logo" />
    <img class="relative bottom-1 left-1" id="logoBg" src="../../img/fire.gif" alt="fire background" />
  </a>

  <ul class="flex justify-center items-center">
    <if-pro>
      <li slot="basic" class="mx-2 md:mx-4  hover:scale-105 transition-transform">
        <a href="../../pro/index.html" class="font-display text-base font-normal text-green-500 border-green-400 border rounded-md px-2 py-1 hover:drop-shadow-[0_0_9px_rgba(34,197,94,0.9)]">PRO</a>
      </li>
    </if-pro>
    <li class="mx-2 md:mx-4 hover:scale-105 transition-transform">
      <a href="../index.html" class="font-sans text-xl font-bold leading-none text-gray2 hover:text-white">labs</a>
    </li>
    <li class="mx-2 md:mx-4  hover:scale-105 transition-transform">
      <a href="../../courses/index.html" class="font-sans text-xl font-bold leading-none text-gray2 gradient-slide">courses</a>
    </li>
    <li class="ml-2">
      <modal-action type="open" name="search">
        <button class="p-2 mr-2 hidden md:flex justify-between items-center bg-white bg-opacity-10 hover:bg-opacity-20 border border-gray4 hover:border-purple-500 
                 shadow-xl hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all">
          <span class="text-gray2 w-4 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
          <span class="mr-12">Search</span>
          <span class="mx-2 text-xs border border-gray4 rounded-md p-1 px-2">/</span>
        </button>
        <button class="flex md:hidden">
          <span class="text-gray2 w-6 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
        </button>
        </modal-action>
      </li>
    <li class="ml-2 mr-6 relative">
      <if-user>
        <a href="../../dashboard/index.html">
          <user-avatar></user-avatar>
        </a>
        <modal-action slot="signed-out" name="signin" type="open">
          <button class="relative hidden md:inline-block px-4 py-2 text-xl font-display text-black hover:text-white bg-white 
                hover:bg-purple-600 drop-shadow-[6px_6px_0_black] hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all duration-300">
            login
          </button>
          <button class="flex md:hidden">
            <span class="text-gray2 w-6 mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M352 96h64c17.7 0 32 14.3 32 32V384c0 17.7-14.3 32-32 32H352c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c53 0 96-43 96-96V128c0-53-43-96-96-96H352c-17.7 0-32 14.3-32 32s14.3 32 32 32zm-7.5 177.4c4.8-4.5 7.5-10.8 7.5-17.4s-2.7-12.9-7.5-17.4l-144-136c-7-6.6-17.2-8.4-26-4.6s-14.5 12.5-14.5 22v72H32c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32H160v72c0 9.6 5.7 18.2 14.5 22s19 2 26-4.6l144-136z"/></svg>
</span>
          </button>
        </modal-action>
      </if-user>
    </li>


  </ul>
</nav>


    
<main class="container">


	<div class="flex w-full justify-between">


		<article itemscope itemtype="http://schema.org/Article" class="w-full">
			<meta itemprop="datePublished" content="2019-06-25 06:14:51 -0700 -0700" />
			<meta itemprop="dateModified" content="2019-06-25 06:14:51 -0700 -0700" />
			<meta itemprop="image" content="img/featured.png" />
			<meta itemprop="publisher" content="Kodeville.io" />


			<header>

				
				
				<div itemprop="video" itemscope itemtype="http://schema.org/VideoObject">
					<iframe class="w-full aspect-video" src="https://www.youtube.com/embed/NWbkKH-2xcQ"
						frameborder="0"
						allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen></iframe>

					<meta itemprop="embedUrl" content="https://www.youtube.com/embed/NWbkKH-2xcQ" />
					<meta itemprop="thumbnailUrl" content="" />
					<meta itemprop="description" content="Accept In App Purchases and microtransactions in Flutter for digital products on the Apple App Store and Google Play Store." />
					<meta itemprop="uploadDate" content="2019-06-25 06:14:51 -0700 -0700" />
					<meta itemprop="publisher" content="Kodeville" />
				</div>
				

				

				<div class="bg-gray6 py-5 px-3 rounded-lg mb-4 flex justify-between mt-3">

					
					
					<a class="flex items-center no-underline" itemprop="author" name="Jeff Delaney" href="../../contributors/jeff-delaney/index.html">
						<img class="w-10 h-10 rounded-full block" src="../../contributors/img/jeff-delaney.webp" alt="Jeff Delaney avatar">
						<span class="flex flex-col ml-2">
							<span class="no-underline">By Jeff Delaney</span>
							<span class="text-xs text-gray4">Posted <time itemprop="dateModified">Jun 25, 2019</time>
						</span>
	
					</a>

					
					<span>
						
							<a href="../../tags/flutter/index.html"><span class="tag tag-flutter">#flutter</span></a>
						
							<a href="../../tags/payments/index.html"><span class="tag tag-payments">#payments</span></a>
						
							<a href="../../tags/ios/index.html"><span class="tag tag-ios">#ios</span></a>
						
							<a href="../../tags/android/index.html"><span class="tag tag-android">#android</span></a>
						

						
					</span>
					
				
				</div>

			</header>



			
			<section class="prose dark:prose-invert max-w-full lesson-content" itemprop="articleBody">
				


				<h1 itemprop="name headline" id="in-app-purchases-in-flutter" class="gradient-text">
					In App Purchases in Flutter
				</h1>


				<p>Flutter recently launched official support for In App Purchases (IAP) and provides a unified plugin for both iOS and Android. Native mobile apps that collect payments for digital goods on the Apple App Store and/or Google Play Store are typically required to use the <a href="https://developer.apple.com/in-app-purchase/">In App Purchases</a> API, which means services like Stripe and Paypal are out of the question (with the exception of payments for physically shipped goods). In reality, In App Purchases are far more lucrative for digital products, with the game Candy Crush generating <a href="https://venturebeat.com/2019/01/09/sensor-tower-candy-crush-players-spent-an-average-of-4-2-million-a-day-in-2018/">$4MM in revenue per day in 2018</a>. The following lesson will show you how to get started with the <a href="https://github.com/flutter/plugins/tree/master/packages/in_app_purchase">in_app_purchase</a> plugin to accept payments, microtransactions, and subscriptions from both stores.</p>
<figure><img src="img/in-app-purchases-demo.gif"
         alt="Demo of a consumable In App Purchase in Flutter on the Google Play Store"/><figcaption>
            <p>Demo of a consumable In App Purchase in Flutter on the Google Play Store</p>
        </figcaption>
</figure>

<h3 id="product-types">Product Types</h3>
<p>In App Purchases between Apple and Google are nearly identical, but you will find some minor differences in the code. This tutorial uses a managed <em>consumable</em> product, which represents an item that can be purchased multiple times, like the useless gems/coins/tokens 💎 you can buy in many mobile games.</p>
<ul>
<li><em>Managed (consumable)</em>. Multi-purchase consumable, can be depleted and repurchased.</li>
<li><em>Managed (non-consumable)</em>. One-time permanently owned product or upgrade.</li>
<li><em>Subscription</em>. Product with recurring payments at specific intervals.</li>
<li><em>Reward (Android)</em>. Provide reward for the user for watching an advertisement via AdMob. Mostly used in games.</li>
</ul>
<h2 id="android-setup">Android Setup</h2>
<p>The Play Store <a href="https://developer.android.com/google/play/billing/billing_overview">Billing</a> API will not work until you have at least an Alpha release track. If you do not have an existing app, check off the items below before proceeding further.</p>
<p>✔️ Register your app and package ID (i.e com.Kodeville.myapp) in the <a href="https://developer.android.com/distribute/console">Google Play Console</a>.</p>
<p>✔️ Follow the steps to create a <a href="https://flutter.dev/docs/deployment/android">signed release APK</a>. Or watch the <a href="../../courses/flutter-firebase/release-android/index.html">Android Flutter Deployment video</a> 🎥.</p>
<p>✔️ Upload the signed APK to Google Play and release it under the Alpha channel. Add testers to the track.</p>
<h3 id="add-a-managed-product">Add a Managed Product</h3>
<figure><img src="img/google-play-product.png"
         alt="Setup a merchant account and create a managed product"/><figcaption>
            <p>Setup a merchant account and create a managed product</p>
        </figcaption>
</figure>

<h2 id="apple-app-store-setup">Apple App Store Setup</h2>
<p>The setup for iOS is similar and requires an existing Apple developer account.</p>
<p>✔️ Release your app and package ID (i.e com.Kodeville.myapp) to <a href="https://appstoreconnect.apple.com/">App Store Connect</a>.</p>
<p>✔️ Follow the steps to create an <a href="https://flutter.dev/docs/deployment/ios">iOS release</a>. Or watch the <a href="../../courses/flutter-firebase/release-ios/index.html">iOS Flutter Deployment video</a> 🎥.</p>
<h3 id="enable-iap-capability-in-xcode">Enable IAP Capability in XCode</h3>
<p>You can enable In App Purchases in Xcode by selecting the build target and flipping the switch under the capabilities tab.</p>
<figure><img src="img/xcode-enable-in-app-purchases.png"
         alt="Enable In App Purchases in Xcode"/><figcaption>
            <p>Enable In App Purchases in Xcode</p>
        </figcaption>
</figure>

<h3 id="app-store-connect-products">App Store Connect Products</h3>
<p>Create a consumable product in Xcode. Make sure to keep the &ldquo;product ID&rdquo; consistent between the App Store and Play Store.</p>
<figure><img src="img/app-store-connect-iap.png"
         alt="Create a product on App Store Connect"/><figcaption>
            <p>Create a product on App Store Connect</p>
        </figcaption>
</figure>

<h2 id="flutter-in-app-purchases-demo">Flutter In App Purchases Demo</h2>
<p>The code below demonstrates how to implement a single <em>consumable</em> product. First, add the plugin to your dependencies.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_flutter</title><polyline points="15.383 18.316 18.744 15.042 27.093 15.042 19.697 22.438 15.383 18.316 15.383 18.316 15.383 18.316 15.383 18.316 15.383 18.316" style="fill:#40d0fd"/><polygon points="4.907 16.125 9.106 20.424 27.093 2.287 18.744 2.287 4.907 16.125" style="fill:#41d0fd;isolation:isolate"/><polygon points="11.176 22.479 15.435 26.675 19.697 22.438 15.383 18.316 11.176 22.479" style="fill:#1fbcfd"/><polygon points="15.435 26.675 19.697 22.438 26.989 29.813 18.593 29.813 15.435 26.675" style="fill:#095a9d"/><polygon points="15.435 26.675 19.406 25.354 18.068 24.057 15.435 26.675" style="fill:#0e5199"/></svg></span> pubspec.yaml
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dependencies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">flutter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sdk</span><span class="p">:</span><span class="w"> </span><span class="l">flutter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">in_app_purchase</span><span class="p">:</span><span class="w"> </span><span class="m">0.2.0+1</span><span class="w">
</span></span></span></code></pre></div><h3 id="in-app-purchases-widget-overview">In App Purchases Widget Overview</h3>
<p>Let&rsquo;s start by creating a StatefulWidget with an abstract representation of the data we&rsquo;ll need to manage for In App Purchases. This widget handles the entire IAP flow, including the retrieval of products/purchases and the facilitation of new purchases.</p>
<p>The code notes below marked <code>TODO</code> are recommendations that you should implement based on your backend setup. For example, you may want to save the the state of a consumable purchase in a database.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_dartlang</title><path d="M16.739,2.037a1.314,1.314,0,0,0-.916.377l-.013.01L7.22,7.389l8.566,8.566v.006l10.3,10.3,1.963-3.536L20.968,5.728l-3.3-3.3a1.307,1.307,0,0,0-.927-.388Z" style="fill:#66c3fa"/><path d="M7.25,7.35,2.288,15.931l-.01.013a1.322,1.322,0,0,0-.378.919,1.3,1.3,0,0,0,.387.924L6.4,21.9l16.084,6.327,3.636-2.02-.1-.1-.025,0-10.083-10.1H15.9L7.25,7.35Z" style="fill:#215896"/><path d="M7.192,7.362l8.764,8.773h.013l10.087,10.1,3.839-.732L29.9,14.14l-4.054-3.973a6.521,6.521,0,0,0-3.624-1.616l0-.044L7.192,7.362Z" style="fill:#235997"/><path d="M7.256,7.411l8.768,8.768v.013L26.116,26.284l-.734,3.839H14.022l-3.971-4.056a6.522,6.522,0,0,1-1.614-3.625l-.044,0L7.256,7.411Z" style="fill:#58b6f0"/></svg></span> purchase.dart
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;dart:async&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:in_app_purchase/in_app_purchase.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">final</span> <span class="kt">String</span> <span class="n">testID</span> <span class="o">=</span> <span class="s1">&#39;gems_test&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">MarketScreen</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">createState</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="n">MarketScreenState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">MarketScreenState</span> <span class="kd">extends</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">MarketScreen</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Is the API available on the device
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">bool</span> <span class="n">available</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// The In App Purchase plugin
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">InAppPurchaseConnection</span> <span class="n">_iap</span> <span class="o">=</span> <span class="n">InAppPurchaseConnection</span><span class="p">.</span><span class="n">instance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Products for sale
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductDetails</span><span class="o">&gt;</span> <span class="n">_products</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Past purchases
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">List</span><span class="o">&lt;</span><span class="n">PurchaseDetails</span><span class="o">&gt;</span> <span class="n">_purchases</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Updates to purchases
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">StreamSubscription</span> <span class="n">_subscription</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Consumable credits the user can buy
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">credits</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">override</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="n">initState</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">_initialize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">super</span><span class="p">.</span><span class="n">initState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">override</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">dispose</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">_subscription</span><span class="p">.</span><span class="n">cancel</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">super</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Initialize data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">_initialize</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">override</span>
</span></span><span class="line"><span class="cl">  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nl">appBar:</span> <span class="n">AppBar</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nl">title:</span> <span class="n">Text</span><span class="p">(</span><span class="n">available</span> <span class="o">?</span> <span class="s1">&#39;Open for Business&#39;</span> <span class="o">:</span> <span class="s1">&#39;Not Available&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nl">body:</span> <span class="n">Center</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nl">child:</span> <span class="n">Column</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nl">children:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="n">prod</span> <span class="k">in</span> <span class="n">_products</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="c1">// UI if already purchased
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">if</span> <span class="p">(</span><span class="n">_hasPurchased</span><span class="p">(</span><span class="n">prod</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">...[</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">              
</span></span><span class="line"><span class="cl">              <span class="c1">// UI if NOT purchased
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">else</span> <span class="p">...[</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Private methods go here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="step-1---get-products-and-past-purchases">Step 1 - Get Products and Past Purchases</h3>
<p>When the app is first initialized you must complete the following tasks:</p>
<ol>
<li>Fetch products.</li>
<li>Fetch past purchases.</li>
<li>Determine if the user has already purchased certain items and deliver them in the app.</li>
</ol>
<p>In the case of consumable products, you will also likely need to query your own database for the current state of the product, such as the &ldquo;user&rsquo;s remaining gems&rdquo;.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_dartlang</title><path d="M16.739,2.037a1.314,1.314,0,0,0-.916.377l-.013.01L7.22,7.389l8.566,8.566v.006l10.3,10.3,1.963-3.536L20.968,5.728l-3.3-3.3a1.307,1.307,0,0,0-.927-.388Z" style="fill:#66c3fa"/><path d="M7.25,7.35,2.288,15.931l-.01.013a1.322,1.322,0,0,0-.378.919,1.3,1.3,0,0,0,.387.924L6.4,21.9l16.084,6.327,3.636-2.02-.1-.1-.025,0-10.083-10.1H15.9L7.25,7.35Z" style="fill:#215896"/><path d="M7.192,7.362l8.764,8.773h.013l10.087,10.1,3.839-.732L29.9,14.14l-4.054-3.973a6.521,6.521,0,0,0-3.624-1.616l0-.044L7.192,7.362Z" style="fill:#235997"/><path d="M7.256,7.411l8.768,8.768v.013L26.116,26.284l-.734,3.839H14.022l-3.971-4.056a6.522,6.522,0,0,1-1.614-3.625l-.044,0L7.256,7.411Z" style="fill:#58b6f0"/></svg></span> purchases.dart
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Initialize data 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">_initialize</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Check availability of In App Purchases
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">_available</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">_iap</span><span class="p">.</span><span class="n">isAvailable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">_available</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kd">await</span> <span class="n">_getProducts</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="kd">await</span> <span class="n">_getPastPurchases</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// Verify and deliver a purchase with your own business logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">_verifyPurchase</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Get all products available for sale
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">_getProducts</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="n">Set</span><span class="p">.</span><span class="n">from</span><span class="p">([</span><span class="n">testID</span><span class="p">,</span> <span class="s1">&#39;test_a&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ProductDetailsResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">_iap</span><span class="p">.</span><span class="n">queryProductDetails</span><span class="p">(</span><span class="n">ids</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">_products</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">productDetails</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Gets past purchases
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">_getPastPurchases</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">QueryPurchaseDetailsResponse</span> <span class="n">response</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="kd">await</span> <span class="n">_iap</span><span class="p">.</span><span class="n">queryPastPurchases</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">PurchaseDetails</span> <span class="n">purchase</span> <span class="k">in</span> <span class="n">response</span><span class="p">.</span><span class="n">pastPurchases</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">final</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">.</span><span class="n">isIOS</span>
</span></span><span class="line"><span class="cl">        <span class="o">?</span> <span class="n">purchaseDetails</span><span class="p">.</span><span class="n">pendingCompletePurchase</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="o">!</span><span class="n">purchaseDetails</span><span class="p">.</span><span class="n">billingClientPurchase</span><span class="p">.</span><span class="n">isAcknowledged</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">pending</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">InAppPurchaseConnection</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="n">completePurchase</span><span class="p">(</span><span class="n">purchase</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">_purchases</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">pastPurchases</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Returns purchase of specific product ID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">PurchaseDetails</span> <span class="n">_hasPurchased</span><span class="p">(</span><span class="kt">String</span> <span class="n">productID</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">_purchases</span><span class="p">.</span><span class="n">firstWhere</span><span class="p">(</span> <span class="p">(</span><span class="n">purchase</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">purchase</span><span class="p">.</span><span class="n">productID</span> <span class="o">==</span> <span class="n">productID</span><span class="p">,</span> <span class="nl">orElse:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Your own business logic to setup a consumable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">_verifyPurchase</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">PurchaseDetails</span> <span class="n">purchase</span> <span class="o">=</span> <span class="n">_hasPurchased</span><span class="p">(</span><span class="n">testID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// TODO serverside verification &amp; record consumable in the database
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">purchase</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">purchase</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PurchaseStatus</span><span class="p">.</span><span class="n">purchased</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">_credits</span> <span class="o">=</span> <span class="m">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h3 id="step-2---handle-new-purchases">Step 2 - Handle New Purchases</h3>
<ol>
<li>Allow the user to make a new purchase.</li>
<li>Listen to a Stream that emits new purchases.</li>
</ol>
<p>By default the plugin will automatically mark the product as consumed, but you can override this behavior with the <code>autoConsume</code> argument. If you set it to false, you must manually mark the product as consumed to enable another purchase (Android only).</p>
<p>The stream only emits the latest purchase as a List, so make sure to merge the emitted value into <code>_purchases</code> and not overwrite the existing list.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_dartlang</title><path d="M16.739,2.037a1.314,1.314,0,0,0-.916.377l-.013.01L7.22,7.389l8.566,8.566v.006l10.3,10.3,1.963-3.536L20.968,5.728l-3.3-3.3a1.307,1.307,0,0,0-.927-.388Z" style="fill:#66c3fa"/><path d="M7.25,7.35,2.288,15.931l-.01.013a1.322,1.322,0,0,0-.378.919,1.3,1.3,0,0,0,.387.924L6.4,21.9l16.084,6.327,3.636-2.02-.1-.1-.025,0-10.083-10.1H15.9L7.25,7.35Z" style="fill:#215896"/><path d="M7.192,7.362l8.764,8.773h.013l10.087,10.1,3.839-.732L29.9,14.14l-4.054-3.973a6.521,6.521,0,0,0-3.624-1.616l0-.044L7.192,7.362Z" style="fill:#235997"/><path d="M7.256,7.411l8.768,8.768v.013L26.116,26.284l-.734,3.839H14.022l-3.971-4.056a6.522,6.522,0,0,1-1.614-3.625l-.044,0L7.256,7.411Z" style="fill:#58b6f0"/></svg></span> main.dart
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="n">_initialize</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// ... omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// Listen to new purchases
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">_subscription</span> <span class="o">=</span> <span class="n">_iap</span><span class="p">.</span><span class="n">purchaseUpdatedStream</span><span class="p">.</span><span class="n">listen</span><span class="p">((</span><span class="n">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s1">&#39;NEW PURCHASE&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">_purchases</span><span class="p">.</span><span class="n">addAll</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">_verifyPurchase</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Purchase a product
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">_buyProduct</span><span class="p">(</span><span class="n">ProductDetails</span> <span class="n">prod</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">PurchaseParam</span> <span class="n">purchaseParam</span> <span class="o">=</span> <span class="n">PurchaseParam</span><span class="p">(</span><span class="nl">productDetails:</span> <span class="n">prod</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// _iap.buyNonConsumable(purchaseParam: purchaseParam);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">_iap</span><span class="p">.</span><span class="n">buyConsumable</span><span class="p">(</span><span class="nl">purchaseParam:</span> <span class="n">purchaseParam</span><span class="p">,</span> <span class="nl">autoConsume:</span> <span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h3 id="step-3---consume-the-product">Step 3 - Consume the Product</h3>
<p>If you are selling one-time upgrade purchase you&rsquo;re done at this point. However, we turned autoConsume off in the previous step, so the product can only be repurchased the purchase has been marked as consumed.</p>
<p>Keep in mind, you should also save the state of the consumable product on your backend database. It cannot be retrieved after the widget is destroyed.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_dartlang</title><path d="M16.739,2.037a1.314,1.314,0,0,0-.916.377l-.013.01L7.22,7.389l8.566,8.566v.006l10.3,10.3,1.963-3.536L20.968,5.728l-3.3-3.3a1.307,1.307,0,0,0-.927-.388Z" style="fill:#66c3fa"/><path d="M7.25,7.35,2.288,15.931l-.01.013a1.322,1.322,0,0,0-.378.919,1.3,1.3,0,0,0,.387.924L6.4,21.9l16.084,6.327,3.636-2.02-.1-.1-.025,0-10.083-10.1H15.9L7.25,7.35Z" style="fill:#215896"/><path d="M7.192,7.362l8.764,8.773h.013l10.087,10.1,3.839-.732L29.9,14.14l-4.054-3.973a6.521,6.521,0,0,0-3.624-1.616l0-.044L7.192,7.362Z" style="fill:#235997"/><path d="M7.256,7.411l8.768,8.768v.013L26.116,26.284l-.734,3.839H14.022l-3.971-4.056a6.522,6.522,0,0,1-1.614-3.625l-.044,0L7.256,7.411Z" style="fill:#58b6f0"/></svg></span> main.dart
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="c1">/// Spend credits and consume purchase when they run pit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">_spendCredits</span><span class="p">(</span><span class="n">PurchaseDetails</span> <span class="n">purchase</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">/// Decrement credits
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span> <span class="n">_credits</span><span class="o">--</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// TODO update the state of the consumable to a backend database
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Mark consumed when credits run out
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">_credits</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">var</span> <span class="n">res</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">_iap</span><span class="p">.</span><span class="n">consumePurchase</span><span class="p">(</span><span class="n">purchase</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="kd">await</span> <span class="n">_getPastPurchases</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h3 id="step-4---the-ui">Step 4 - The UI</h3>
<p>The build method implements a bare minimum UI that loops over each product and provides buttons to buy and consume them.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="err">@</span><span class="n">override</span>
</span></span><span class="line"><span class="cl">  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nl">appBar:</span> <span class="n">AppBar</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nl">title:</span> <span class="n">Text</span><span class="p">(</span><span class="n">available</span> <span class="o">?</span> <span class="s1">&#39;Open for Business&#39;</span> <span class="o">:</span> <span class="s1">&#39;Not Available&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nl">body:</span> <span class="n">Center</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nl">child:</span> <span class="n">Column</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nl">mainAxisAlignment:</span> <span class="n">MainAxisAlignment</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nl">children:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="n">prod</span> <span class="k">in</span> <span class="n">_products</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="c1">// UI if already purchased
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">if</span> <span class="p">(</span><span class="n">_hasPurchased</span><span class="p">(</span><span class="n">prod</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">...[</span>
</span></span><span class="line"><span class="cl">                  <span class="n">Text</span><span class="p">(</span><span class="s1">&#39;💎 </span><span class="si">$</span><span class="n">credits</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">fontSize:</span> <span class="m">60</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                  <span class="n">FlatButton</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Consume&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="nl">color:</span> <span class="n">Colors</span><span class="p">.</span><span class="n">green</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nl">onPressed:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">_spendCredits</span><span class="p">(</span><span class="n">_hasPurchased</span><span class="p">(</span><span class="n">prod</span><span class="p">.</span><span class="n">id</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                  <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">              
</span></span><span class="line"><span class="cl">              <span class="c1">// UI if NOT purchased
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">else</span> <span class="p">...[</span>
</span></span><span class="line"><span class="cl">                <span class="n">Text</span><span class="p">(</span><span class="n">prod</span><span class="p">.</span><span class="n">title</span><span class="p">,</span> <span class="nl">style:</span> <span class="n">Theme</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">context</span><span class="p">).</span><span class="n">textTheme</span><span class="p">.</span><span class="n">headline</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">Text</span><span class="p">(</span><span class="n">prod</span><span class="p">.</span><span class="n">description</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">Text</span><span class="p">(</span><span class="n">prod</span><span class="p">.</span><span class="n">price</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">color:</span> <span class="n">Colors</span><span class="p">.</span><span class="n">greenAccent</span><span class="p">,</span> <span class="nl">fontSize:</span> <span class="m">60</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                <span class="n">FlatButton</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                  <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Buy It&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                  <span class="nl">color:</span> <span class="n">Colors</span><span class="p">.</span><span class="n">green</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nl">onPressed:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">_buyProduct</span><span class="p">(</span><span class="n">prod</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div>

				
			</section>

			<section id="qna" class="my-12 flex flex-col justify-between items-center">
    <h2 class="text-2xl mb-4">Questions? Let's chat</h2>
    <a href="https://discord.gg/SpDdJ3qaKK" class="btn btn-purple btn-lg btn-glow btn-display mx-auto"><span class="w-8 mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></span> Open Discord</a>
    <div class="mt-3">
        <discord-count></discord-count>
    </div>
</section>

		</article>
		
		
		<aside class="tableOfContents">
			<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#product-types">Product Types</a></li>
      </ul>
    </li>
    <li><a href="#android-setup">Android Setup</a>
      <ul>
        <li><a href="#add-a-managed-product">Add a Managed Product</a></li>
      </ul>
    </li>
    <li><a href="#apple-app-store-setup">Apple App Store Setup</a>
      <ul>
        <li><a href="#enable-iap-capability-in-xcode">Enable IAP Capability in XCode</a></li>
        <li><a href="#app-store-connect-products">App Store Connect Products</a></li>
      </ul>
    </li>
    <li><a href="#flutter-in-app-purchases-demo">Flutter In App Purchases Demo</a>
      <ul>
        <li><a href="#in-app-purchases-widget-overview">In App Purchases Widget Overview</a></li>
        <li><a href="#step-1---get-products-and-past-purchases">Step 1 - Get Products and Past Purchases</a></li>
        <li><a href="#step-2---handle-new-purchases">Step 2 - Handle New Purchases</a></li>
        <li><a href="#step-3---consume-the-product">Step 3 - Consume the Product</a></li>
        <li><a href="#step-4---the-ui">Step 4 - The UI</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		
	</div>


</main>

    
<footer class="container text-center my-6 p-8 text-gray3">
    <div class="mx-auto w-24 h-1 my-12 bg-gradient-to-r from-gray5 to-gray4 rounded-full"></div>
    <div class="pt-10">Find an issue with this page? <a class="text-blue-500" href="https://github.com/k0deville/k0deville.github.io">Fix it on GitHub</a></div>

    <div class="py-3">
        Need help? Email <a href="mailto:kodeville97@gmail.com"><strong class="text-white font-bold">kodeville97@gmail.com</strong></a>
    </div>
    <div class="flex justify-center items-center my-2">
        <a href="https://www.youtube.com/c/Kodeville"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svgyoutube  "><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" ></path></svg></i></a>
        <a href="https://twitter.com/Kodeville_dev"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svgtwitter  "><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" ></path></svg></i></a>
        <a href="https://github.com/Kodeville-io"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svggithub "><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" ></path></svg></i></a>
        <a href="https://discord.gg/SpDdJ3qaKK"><i class="w-6 inline-block mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></i></a>
    </div>

    <h6>Helpful Links</h6>

    <div class="py-3">
        <a href="../../courses/index.html">Courses</a> | 
        <a href="../index.html">Labs</a> | 
        <a href="../../snippets/index.html">Snippets</a> | 
        <a href="../../tags/index.html">Tags</a> | 
        <a href="../../contributors/index.html">Contrib</a> |
        <a href="../../privacy/index.html">Privacy</a> | 
        <a href="../../terms/index.html">Terms</a>
    </div>

    
    <div class="text-xs">
        Copyright 2023 KodeVille Pvt Ltd<br> 
    </div>

</footer>




    <app-signin></app-signin>
    <algolia-search></algolia-search>
    <hi-mom></hi-mom>

    <email-handler></email-handler>

    <route-loader>
      <div class="fixed w-full top-0 left-0 h-1 gradient-loader"></div>
    </route-loader>

    <toast-message></toast-message>
    <scroll-up></scroll-up>

    </div>

  </body>

<!-- Mirrored from Kodeville.io/lessons/flutter-inapp-purchases/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:07:55 GMT -->
</html>