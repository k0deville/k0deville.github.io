<!DOCTYPE html>
<html class="dark">
  
<!-- Mirrored from Kodeville.io/lessons/angular-firebase-storage-uploads-multi/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:09:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Upload Multiple Files to Firebase Storage with Angular</title>
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../../svelte/index.be288b01.css" />
    <script type="module" defer src="../../svelte/index.3d7fd5b5.js" /></script>

    
    <link rel="shortcut icon" href="../../img/favicon.png" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="../../img/favicon.png" />
    <meta name="theme-color" content="#454e56">
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <link rel="manifest" href="../../manifest.json">
    

 




    <link rel="canonical" href="index.html" />

    <meta name="description" content="Build a dropzone file uploader in Angular that can send multiple files to Firebase storage simultaneously.">
    <meta name="image" content="https://Kodeville.io/lessons/angular-firebase-storage-uploads-multi/img/featured.png">

    <meta property="og:title" content="Upload Multiple Files to Firebase Storage with Angular" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://Kodeville.io/lessons/angular-firebase-storage-uploads-multi/" />
    <meta property="og:image" content="https://Kodeville.io/lessons/angular-firebase-storage-uploads-multi/img/featured.png" />
    <meta property="og:description" content="Build a dropzone file uploader in Angular that can send multiple files to Firebase storage simultaneously." />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Kodeville_dev">
    <meta name="twitter:title" content="Upload Multiple Files to Firebase Storage with Angular">
    <meta name="twitter:description" content="Build a dropzone file uploader in Angular that can send multiple files to Firebase storage simultaneously.">
    <meta name="twitter:image" content="https://Kodeville.io/lessons/angular-firebase-storage-uploads-multi/img/featured.png">
    
    <script>
      if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
              navigator.serviceWorker.register('../../sw.js');
          });
      }
    </script>

  </head>
  <body>
    <global-data 
    permalink="https://Kodeville.io/lessons/angular-firebase-storage-uploads-multi/" 
    vimeo=""
    youtube="ok7633BVa4Y"
    free=""
    next="https://Kodeville.io/lessons/flutter-realtime-geolocation-firebase/" 
    prev="https://Kodeville.io/lessons/pwa-to-play-store/">
  </global-data>

    
<nav class="flex justify-between container p-6 md:p-8">
  <a
    class="flex justify-center items-center text-center w-12 h-12 logo-gif"
    href="../../index.html"
  >
    <img id="logo" src="../../img/logo.svg" alt="logo" />
    <img class="relative bottom-1 left-1" id="logoBg" src="../../img/fire.gif" alt="fire background" />
  </a>

  <ul class="flex justify-center items-center">
    <if-pro>
      <li slot="basic" class="mx-2 md:mx-4  hover:scale-105 transition-transform">
        <a href="../../pro/index.html" class="font-display text-base font-normal text-green-500 border-green-400 border rounded-md px-2 py-1 hover:drop-shadow-[0_0_9px_rgba(34,197,94,0.9)]">PRO</a>
      </li>
    </if-pro>
    <li class="mx-2 md:mx-4 hover:scale-105 transition-transform">
      <a href="../index.html" class="font-sans text-xl font-bold leading-none text-gray2 hover:text-white">labs</a>
    </li>
    <li class="mx-2 md:mx-4  hover:scale-105 transition-transform">
      <a href="../../courses/index.html" class="font-sans text-xl font-bold leading-none text-gray2 gradient-slide">courses</a>
    </li>
    <li class="ml-2">
      <modal-action type="open" name="search">
        <button class="p-2 mr-2 hidden md:flex justify-between items-center bg-white bg-opacity-10 hover:bg-opacity-20 border border-gray4 hover:border-purple-500 
                 shadow-xl hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all">
          <span class="text-gray2 w-4 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
          <span class="mr-12">Search</span>
          <span class="mx-2 text-xs border border-gray4 rounded-md p-1 px-2">/</span>
        </button>
        <button class="flex md:hidden">
          <span class="text-gray2 w-6 mx-2">
<svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fk-search fk-w-16 fk-9x">
<g class="fk-group"><path fill="currentColor" d="M208 80a128 128 0 1 1-90.51 37.49A127.15 127.15 0 0 1 208 80m0-80C93.12 0 0 93.12 0 208s93.12 208 208 208 208-93.12 208-208S322.88 0 208 0z" class="fk-secondary"></path><path fill="currentColor" d="M504.9 476.7L476.6 505a23.9 23.9 0 0 1-33.9 0L343 405.3a24 24 0 0 1-7-17V372l36-36h16.3a24 24 0 0 1 17 7l99.7 99.7a24.11 24.11 0 0 1-.1 34z" class="fk-primary">
</path></g></svg></span>
        </button>
        </modal-action>
      </li>
    <li class="ml-2 mr-6 relative">
      <if-user>
        <a href="../../dashboard/index.html">
          <user-avatar></user-avatar>
        </a>
        <modal-action slot="signed-out" name="signin" type="open">
          <button class="relative hidden md:inline-block px-4 py-2 text-xl font-display text-black hover:text-white bg-white 
                hover:bg-purple-600 drop-shadow-[6px_6px_0_black] hover:drop-shadow-[0_0_7px_rgba(168,85,247,0.5)] transition-all duration-300">
            login
          </button>
          <button class="flex md:hidden">
            <span class="text-gray2 w-6 mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M352 96h64c17.7 0 32 14.3 32 32V384c0 17.7-14.3 32-32 32H352c-17.7 0-32 14.3-32 32s14.3 32 32 32h64c53 0 96-43 96-96V128c0-53-43-96-96-96H352c-17.7 0-32 14.3-32 32s14.3 32 32 32zm-7.5 177.4c4.8-4.5 7.5-10.8 7.5-17.4s-2.7-12.9-7.5-17.4l-144-136c-7-6.6-17.2-8.4-26-4.6s-14.5 12.5-14.5 22v72H32c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32H160v72c0 9.6 5.7 18.2 14.5 22s19 2 26-4.6l144-136z"/></svg>
</span>
          </button>
        </modal-action>
      </if-user>
    </li>


  </ul>
</nav>


    
<main class="container">


	<div class="flex w-full justify-between">


		<article itemscope itemtype="http://schema.org/Article" class="w-full">
			<meta itemprop="datePublished" content="2019-02-18 13:45:50 -0700 -0700" />
			<meta itemprop="dateModified" content="2019-02-18 13:45:50 -0700 -0700" />
			<meta itemprop="image" content="img/featured.png" />
			<meta itemprop="publisher" content="Kodeville.io" />


			<header>

				
				
				<div itemprop="video" itemscope itemtype="http://schema.org/VideoObject">
					<iframe class="w-full aspect-video" src="https://www.youtube.com/embed/ok7633BVa4Y"
						frameborder="0"
						allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen></iframe>

					<meta itemprop="embedUrl" content="https://www.youtube.com/embed/ok7633BVa4Y" />
					<meta itemprop="thumbnailUrl" content="" />
					<meta itemprop="description" content="Build a dropzone file uploader in Angular that can send multiple files to Firebase storage simultaneously." />
					<meta itemprop="uploadDate" content="2019-02-18 13:45:50 -0700 -0700" />
					<meta itemprop="publisher" content="Kodeville" />
				</div>
				

				

				<div class="bg-gray6 py-5 px-3 rounded-lg mb-4 flex justify-between mt-3">

					
					
					<a class="flex items-center no-underline" itemprop="author" name="Jeff Delaney" href="../../contributors/jeff-delaney/index.html">
						<img class="w-10 h-10 rounded-full block" src="../../contributors/img/jeff-delaney.webp" alt="Jeff Delaney avatar">
						<span class="flex flex-col ml-2">
							<span class="no-underline">By Jeff Delaney</span>
							<span class="text-xs text-gray4">Posted <time itemprop="dateModified">Feb 18, 2019</time>
						</span>
	
					</a>

					
					<span>
						
							<a href="../../tags/firebase/index.html"><span class="tag tag-firebase">#firebase</span></a>
						
							<a href="../../tags/angular/index.html"><span class="tag tag-angular">#angular</span></a>
						
							<a href="../../tags/cloud-storage/index.html"><span class="tag tag-cloud-storage">#cloud-storage</span></a>
						

						
							<a class="btn btn-transparent ml-4" href="https://github.com/Kodeville-io/168-multi-file-upload-angular-firebase">
								Source Code
							</a>
						
					</span>
					
				
				</div>

			</header>



			
			<section class="prose dark:prose-invert max-w-full lesson-content" itemprop="articleBody">
				


				<h1 itemprop="name headline" id="upload-multiple-files-to-firebase-storage-with-angular" class="gradient-text">
					Upload Multiple Files to Firebase Storage with Angular
				</h1>


				<p>Firebase makes it easy to upload a huge payload of raw files a cloud storage bucket. The following lesson will teach you how to upload files to <a href="https://firebase.google.com/docs/storage/">Firebase Storage</a> with Angular, including several advanced concepts about how to&hellip;</p>
<ul>
<li>Handle multiple simultaneous concurrent file uploads.</li>
<li>Save the resulting download URL to Firestore.</li>
<li>Display a progress bar and provide UI controls to pause, cancel, and resume uploads.</li>
</ul>
<figure><img src="img/dropzone-firebase-storage.png"
         alt="Firebase storage demo with multiple files"/>
</figure>

<p>This post first appeared as <a href="https://angularfirebase.com/lessons/firebase-storage-with-angularfire-dropzone-file-uploader/">Episode 82 on AngularFirebase.com</a> and has been updated to handle multiple files and save additional data to Firestore.</p>
<p>The demo video below demonstrates how the complete feature should work after completing this lesson.</p>
<p><video controls src="https://firebasestorage.googleapis.com/v0/b/Kodeville-app.appspot.com/o/assets%2FE168-Uploads%2F16-demo.mp4?alt=media&amp;token=849c6efb-9b47-4b3f-89a4-4eac797704e2"></video></p>
<h2 id="step-0---prerequisites">Step 0 - Prerequisites</h2>
<ol>
<li>Install AngularFire <code>ng add @angular/fire</code></li>
</ol>
<h3 id="base-css-styles">Base CSS Styles</h3>
<p>Below you will find the base CSS styles for a basic dropzone.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_scss2</title><path d="M16,2A14,14,0,1,1,2,16,14,14,0,0,1,16,2Z" style="fill:#c69;fill-rule:evenodd"/><path d="M24.782,7.992c-.634-2.486-4.757-3.3-8.659-1.918A19.605,19.605,0,0,0,9.479,9.885c-2.149,2.01-2.492,3.76-2.351,4.491.5,2.58,4.033,4.266,5.486,5.517V19.9c-.428.211-3.564,1.8-4.3,3.42-.774,1.712.123,2.94.718,3.105A4.4,4.4,0,0,0,13.78,24.5a4.824,4.824,0,0,0,.472-4.288,5.639,5.639,0,0,1,2.143-.123c2.456.287,2.938,1.82,2.846,2.462a1.62,1.62,0,0,1-.779,1.1c-.172.107-.225.143-.21.223.021.115.1.111.247.086a1.915,1.915,0,0,0,1.336-1.707c.059-1.5-1.382-3.186-3.934-3.143a6.736,6.736,0,0,0-2.189.3c-.035-.04-.071-.08-.108-.12-1.578-1.683-4.494-2.874-4.371-5.137.045-.823.331-2.989,5.6-5.617,4.32-2.153,7.778-1.56,8.376-.247.854,1.876-1.848,5.361-6.334,5.864a3.37,3.37,0,0,1-2.833-.718c-.236-.26-.271-.271-.359-.223-.143.079-.052.309,0,.445a2.659,2.659,0,0,0,1.621,1.274,8.592,8.592,0,0,0,5.258-.52C23.283,13.362,25.405,10.437,24.782,7.992ZM13.218,20.663a3.584,3.584,0,0,1-.029,2.092q-.035.106-.077.21t-.091.2a3.911,3.911,0,0,1-.647.943c-.813.887-1.95,1.223-2.437.94-.526-.305-.263-1.556.68-2.553a9.478,9.478,0,0,1,2.474-1.762l0,0Z" style="fill:#fff"/></svg></span> styles.scss
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scss" data-lang="scss"><span class="line"><span class="cl"><span class="nc">.dropzone</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">  <span class="na">display</span><span class="o">:</span> <span class="ni">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">align-items</span><span class="o">:</span> <span class="ni">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">justify-content</span><span class="o">:</span> <span class="ni">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex-direction</span><span class="o">:</span> <span class="ni">column</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="na">min-width</span><span class="o">:</span> <span class="mi">80</span><span class="kt">vw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">font-weight</span><span class="o">:</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">:</span> <span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">border</span><span class="o">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="ni">dashed</span> <span class="mh">#f16624</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">border-radius</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">background</span><span class="o">:</span> <span class="ni">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">margin</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">&amp;</span><span class="nc">.hovering</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="na">border</span><span class="o">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="ni">solid</span> <span class="mh">#f16624</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="na">color</span><span class="o">:</span> <span class="mh">#dadada</span> <span class="k">!important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nc">.file-label</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.2</span><span class="kt">em</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">progress</span><span class="nd">::-webkit-progress-value</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">transition</span><span class="o">:</span> <span class="ni">width</span> <span class="mi">0</span><span class="mf">.1</span><span class="kt">s</span> <span class="ni">ease</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="step-1---directive-to-receive-files-from-the-browser">Step 1 - Directive to Receive Files from the Browser</h2>
<p>Want to skip this step? Consider using this zero-dependency <a href="https://github.com/GoogleChromeLabs/file-drop">file-drop</a> web component developed by Google Chrome Labs</p>
<p>The first step is to create a directive that can receive the files from the browser. The directive customize the <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API">Drag and Drop API</a> to meet the specific needs of our feature.</p>


<div class="file-name">
  <span class="file-icon"><svg aria-hidden="true" data-prefix="fas" data-icon="terminal" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svgterminal  "><path fill="currentColor" d="M257.981 272.971L63.638 467.314c-9.373 9.373-24.569 9.373-33.941 0L7.029 444.647c-9.357-9.357-9.375-24.522-.04-33.901L161.011 256 6.99 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L257.981 239.03c9.373 9.372 9.373 24.568 0 33.941zM640 456v-32c0-13.255-10.745-24-24-24H312c-13.255 0-24 10.745-24 24v32c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24z" ></path></svg></span> command line
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ng g directive dropzone
</span></span></code></pre></div><h3 id="emit-files-as-a-custom-event">Emit Files as a Custom Event</h3>
<p>The most important aspect of the directive below is that it listens to the <a href="https://developer.mozilla.org/en-US/docs/Web/Events/drop">drop</a> event on the parent element. This event contains the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileList">FileList</a> that the user wants to upload. This data is emitted up as a custom event so it can be used by our <code>Uploader</code> component in the next step.</p>
<p>In addition, we listen to dragover/dragleave events so we can toggle CSS styles when the user is hovering over the dropzone.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_ng_component_ts</title><path d="M2.73,6.67,15.85,2V30L4.77,23.88Z" style="fill:#de3641"/><path d="M15.85,2,29.27,6.59,27.08,23.8,15.85,30Z" style="fill:#b13138"/><path d="M15.85,5.14l8.53,18.23H21.47l-1.82-4.16h-3.8V16.73h2.77L15.85,11l-2.33,5.73h2.33v2.48H12.38l-1.63,4.16H7.61Z" style="fill:#fff"/><path d="M27.41,19.65a2.81,2.81,0,0,1,1.41.81,3.72,3.72,0,0,1,.54.72s-1,.69-1.57,1.06a.5.5,0,0,1-.2-.22,1.28,1.28,0,0,0-1.06-.64.92.92,0,0,0-1.12.91.83.83,0,0,0,.1.42,2.23,2.23,0,0,0,1.31.88c1.62.7,2.31,1.16,2.74,1.81a3.28,3.28,0,0,1,.26,2.76A3,3,0,0,1,27.31,30a6.93,6.93,0,0,1-1.72,0,4.15,4.15,0,0,1-2.3-1.2,4,4,0,0,1-.59-.87l.21-.13.84-.48.65-.38.14.2a3,3,0,0,0,.86.82,2.1,2.1,0,0,0,2.2-.11,1,1,0,0,0,.13-1.25,3.72,3.72,0,0,0-1.55-.9A5.6,5.6,0,0,1,24,24.32a3,3,0,0,1-.62-1.13,4.53,4.53,0,0,1,0-1.44A2.76,2.76,0,0,1,25.7,19.6,5.73,5.73,0,0,1,27.41,19.65Zm-5.31.94v.93H19.16v8.36H17.08V21.52H14.14v-.91a8.9,8.9,0,0,1,0-.93h8v.92Z" style="fill:#007acc"/></svg></span> dropzone.directive.ts
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Directive</span><span class="p">,</span> <span class="nx">HostListener</span><span class="p">,</span> <span class="nx">Output</span><span class="p">,</span> <span class="nx">EventEmitter</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Directive</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;[dropzone]&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">DropzoneDirective</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">@Output</span><span class="p">()</span> <span class="nx">dropped</span> <span class="o">=</span>  <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">&lt;</span><span class="nt">FileList</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Output</span><span class="p">()</span> <span class="nx">hovered</span> <span class="o">=</span>  <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">&lt;</span><span class="nt">boolean</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">@HostListener</span><span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$event&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onDrop</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">dropped</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">$event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">files</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">hovered</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">@HostListener</span><span class="p">(</span><span class="s1">&#39;dragover&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$event&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onDragOver</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">hovered</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">@HostListener</span><span class="p">(</span><span class="s1">&#39;dragleave&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$event&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onDragLeave</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">hovered</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="step-2---uploader-component">Step 2 - Uploader Component</h2>
<p>The next step is put our directive to use in a component that will receive the files and loop over them. This component does not use Firebase directly, but rather it manages the files dropped by the user and renders an <code>upload-task</code> (which we will build in step 3) component for each file.</p>


<div class="file-name">
  <span class="file-icon"><svg aria-hidden="true" data-prefix="fas" data-icon="terminal" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svgterminal  "><path fill="currentColor" d="M257.981 272.971L63.638 467.314c-9.373 9.373-24.569 9.373-33.941 0L7.029 444.647c-9.357-9.357-9.375-24.522-.04-33.901L161.011 256 6.99 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L257.981 239.03c9.373 9.372 9.373 24.568 0 33.941zM640 456v-32c0-13.255-10.745-24-24-24H312c-13.255 0-24 10.745-24 24v32c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24z" ></path></svg></span> command line
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ng g component uploader
</span></span></code></pre></div><h3 id="listen-to-file-drop">Listen to File Drop</h3>
<p>The HTML we add the <code>dropzone</code> directive to a div and listen the custom events that it emits. In addition, we loop over a list of files and render <code>upload-task</code> which will be created in the next step.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_html</title><polygon points="5.902 27.201 3.655 2 28.345 2 26.095 27.197 15.985 30 5.902 27.201" style="fill:#e44f26"/><polygon points="16 27.858 24.17 25.593 26.092 4.061 16 4.061 16 27.858" style="fill:#f1662a"/><polygon points="16 13.407 11.91 13.407 11.628 10.242 16 10.242 16 7.151 15.989 7.151 8.25 7.151 8.324 7.981 9.083 16.498 16 16.498 16 13.407" style="fill:#ebebeb"/><polygon points="16 21.434 15.986 21.438 12.544 20.509 12.324 18.044 10.651 18.044 9.221 18.044 9.654 22.896 15.986 24.654 16 24.65 16 21.434" style="fill:#ebebeb"/><polygon points="15.989 13.407 15.989 16.498 19.795 16.498 19.437 20.507 15.989 21.437 15.989 24.653 22.326 22.896 22.372 22.374 23.098 14.237 23.174 13.407 22.341 13.407 15.989 13.407" style="fill:#fff"/><polygon points="15.989 7.151 15.989 9.071 15.989 10.235 15.989 10.242 23.445 10.242 23.445 10.242 23.455 10.242 23.517 9.548 23.658 7.981 23.732 7.151 15.989 7.151" style="fill:#fff"/></svg></span> uploader.component.html
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;dropzone&#34;</span> 
</span></span><span class="line"><span class="cl">     <span class="na">dropzone</span>
</span></span><span class="line"><span class="cl">     <span class="err">(</span><span class="na">hovered</span><span class="err">)=&#34;</span><span class="na">toggleHover</span><span class="err">($</span><span class="na">event</span><span class="err">)&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="err">(</span><span class="na">dropped</span><span class="err">)=&#34;</span><span class="na">onDrop</span><span class="err">($</span><span class="na">event</span><span class="err">)&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="err">[</span><span class="na">class</span><span class="err">.</span><span class="na">hovering</span><span class="err">]=&#34;</span><span class="na">isHovering</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>AngularFire Drop Zone<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Drag and Drop a File<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Uploads<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngFor</span><span class="o">=</span><span class="s">&#34;let file of files&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">upload-task</span> <span class="err">[</span><span class="na">file</span><span class="err">]=&#34;</span><span class="na">file</span><span class="err">&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">upload-task</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>The component typescript is very simple - it just takes the FileList dropped on the div and pushes it to an array.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_ng_component_ts</title><path d="M2.73,6.67,15.85,2V30L4.77,23.88Z" style="fill:#de3641"/><path d="M15.85,2,29.27,6.59,27.08,23.8,15.85,30Z" style="fill:#b13138"/><path d="M15.85,5.14l8.53,18.23H21.47l-1.82-4.16h-3.8V16.73h2.77L15.85,11l-2.33,5.73h2.33v2.48H12.38l-1.63,4.16H7.61Z" style="fill:#fff"/><path d="M27.41,19.65a2.81,2.81,0,0,1,1.41.81,3.72,3.72,0,0,1,.54.72s-1,.69-1.57,1.06a.5.5,0,0,1-.2-.22,1.28,1.28,0,0,0-1.06-.64.92.92,0,0,0-1.12.91.83.83,0,0,0,.1.42,2.23,2.23,0,0,0,1.31.88c1.62.7,2.31,1.16,2.74,1.81a3.28,3.28,0,0,1,.26,2.76A3,3,0,0,1,27.31,30a6.93,6.93,0,0,1-1.72,0,4.15,4.15,0,0,1-2.3-1.2,4,4,0,0,1-.59-.87l.21-.13.84-.48.65-.38.14.2a3,3,0,0,0,.86.82,2.1,2.1,0,0,0,2.2-.11,1,1,0,0,0,.13-1.25,3.72,3.72,0,0,0-1.55-.9A5.6,5.6,0,0,1,24,24.32a3,3,0,0,1-.62-1.13,4.53,4.53,0,0,1,0-1.44A2.76,2.76,0,0,1,25.7,19.6,5.73,5.73,0,0,1,27.41,19.65Zm-5.31.94v.93H19.16v8.36H17.08V21.52H14.14v-.91a8.9,8.9,0,0,1,0-.93h8v.92Z" style="fill:#007acc"/></svg></span> uploader.component.ts
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;uploader&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./uploader.component.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./uploader.component.scss&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">UploaderComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">isHovering</span>: <span class="kt">boolean</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">files</span>: <span class="kt">File</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">toggleHover</span><span class="p">(</span><span class="nx">event</span>: <span class="kt">boolean</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">isHovering</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">onDrop</span><span class="p">(</span><span class="nx">files</span>: <span class="kt">FileList</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">files</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="step-3---upload-task-component">Step 3 - Upload Task Component</h2>


<div class="file-name">
  <span class="file-icon"><svg aria-hidden="true" data-prefix="fas" data-icon="terminal" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svgterminal  "><path fill="currentColor" d="M257.981 272.971L63.638 467.314c-9.373 9.373-24.569 9.373-33.941 0L7.029 444.647c-9.357-9.357-9.375-24.522-.04-33.901L161.011 256 6.99 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L257.981 239.03c9.373 9.372 9.373 24.568 0 33.941zM640 456v-32c0-13.255-10.745-24-24-24H312c-13.255 0-24 10.745-24 24v32c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24z" ></path></svg></span> command line
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ng g component upload-task
</span></span></code></pre></div><p>Each child component is a self contained <a href="https://github.com/angular/angularfire2/blob/master/docs/storage/storage.md">UploadTask</a> that will start running as soon as the component is initialized. It will display the upload progress in realtime and save the download URL in firestore when it completes.</p>
<p>There is no hard limit on the number of files you can send to Firebase simultaneously. The SDK will attempt to use the most efficient strategy available to transfer them to the cloud, which is mostly dependent on the user&rsquo;s network connection.</p>
<h3 id="show-progress-and-provide-user-controls">Show Progress and Provide User Controls</h3>
<p>The HTML provides a progress bar and several buttons that allow the user to pause, cancel, or resume an individual upload.</p>


<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_html</title><polygon points="5.902 27.201 3.655 2 28.345 2 26.095 27.197 15.985 30 5.902 27.201" style="fill:#e44f26"/><polygon points="16 27.858 24.17 25.593 26.092 4.061 16 4.061 16 27.858" style="fill:#f1662a"/><polygon points="16 13.407 11.91 13.407 11.628 10.242 16 10.242 16 7.151 15.989 7.151 8.25 7.151 8.324 7.981 9.083 16.498 16 16.498 16 13.407" style="fill:#ebebeb"/><polygon points="16 21.434 15.986 21.438 12.544 20.509 12.324 18.044 10.651 18.044 9.221 18.044 9.654 22.896 15.986 24.654 16 24.65 16 21.434" style="fill:#ebebeb"/><polygon points="15.989 13.407 15.989 16.498 19.795 16.498 19.437 20.507 15.989 21.437 15.989 24.653 22.326 22.896 22.372 22.374 23.098 14.237 23.174 13.407 22.341 13.407 15.989 13.407" style="fill:#fff"/><polygon points="15.989 7.151 15.989 9.071 15.989 10.235 15.989 10.242 23.445 10.242 23.445 10.242 23.455 10.242 23.517 9.548 23.658 7.981 23.732 7.151 15.989 7.151" style="fill:#fff"/></svg></span> upload-task.component.html
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&#34;percentage | async as pct&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">progress</span> <span class="err">[</span><span class="na">value</span><span class="err">]=&#34;</span><span class="na">pct</span><span class="err">&#34;</span> <span class="na">max</span><span class="o">=</span><span class="s">&#34;100&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">progress</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  {{ pct | number }}%
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&#34;snapshot | async as snap&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  {{ snap.bytesTransferred }} of {{ snap.totalBytes }} 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&#34;downloadURL as url&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Results!<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">img</span> <span class="err">[</span><span class="na">src</span><span class="err">]=&#34;</span><span class="na">url</span><span class="err">&#34;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="err">[</span><span class="na">href</span><span class="err">]=&#34;</span><span class="na">url</span><span class="err">&#34;</span> <span class="na">target</span><span class="o">=</span><span class="s">&#34;_blank&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;noopener&#34;</span><span class="p">&gt;</span>Download Me!<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&#34;</span><span class="na">task</span><span class="err">.</span><span class="na">pause</span><span class="err">()&#34;</span> <span class="err">[</span><span class="na">disabled</span><span class="err">]=&#34;!</span><span class="na">isActive</span><span class="err">(</span><span class="na">snap</span><span class="err">)&#34;</span><span class="p">&gt;</span>Pause<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&#34;</span><span class="na">task</span><span class="err">.</span><span class="na">cancel</span><span class="err">()&#34;</span> <span class="err">[</span><span class="na">disabled</span><span class="err">]=&#34;!</span><span class="na">isActive</span><span class="err">(</span><span class="na">snap</span><span class="err">)&#34;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&#34;</span><span class="na">task</span><span class="err">.</span><span class="na">resume</span><span class="err">()&#34;</span> <span class="err">[</span><span class="na">disabled</span><span class="err">]=&#34;!(</span><span class="na">snap</span><span class="err">?.</span><span class="na">state </span><span class="o">=</span><span class="s">==</span> <span class="err">&#39;</span><span class="na">paused</span><span class="err">&#39;)&#34;</span><span class="p">&gt;</span>Resume<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>The component is responsible for managing the state of the upload. In this demo, the upload starts transferring data when initialized with <code>ngOnInit</code>. It takes the file as an input property, then uses it&rsquo;s name as a reference in the storage bucket. Keep in mind, storage path names must be unique (just like any filesystem), so we also add a timestamp to the name to ensure uniqueness on each upload.</p>
<p>The <code>snapshotChanges</code> Observable emits data every few hundred milliseconds with information about the upload&rsquo;s progress. You can use it for progress indicators or alternatively use <code>percentageChanges</code> to listen the current progress ranging from 0 to 100.</p>
<p>We can detect when the upload has finished using the RxJS <code>finalize</code> operator. At this point, we can fetch the public download URL and save it to Firestore for easy access in the future.</p>
<figure><img src="img/firestore-download-url.png"
         alt="Firebase storage uploads with a reference to Firestore"/>
</figure>



<div class="file-name">
  <span class="file-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><title>file_type_ng_component_ts</title><path d="M2.73,6.67,15.85,2V30L4.77,23.88Z" style="fill:#de3641"/><path d="M15.85,2,29.27,6.59,27.08,23.8,15.85,30Z" style="fill:#b13138"/><path d="M15.85,5.14l8.53,18.23H21.47l-1.82-4.16h-3.8V16.73h2.77L15.85,11l-2.33,5.73h2.33v2.48H12.38l-1.63,4.16H7.61Z" style="fill:#fff"/><path d="M27.41,19.65a2.81,2.81,0,0,1,1.41.81,3.72,3.72,0,0,1,.54.72s-1,.69-1.57,1.06a.5.5,0,0,1-.2-.22,1.28,1.28,0,0,0-1.06-.64.92.92,0,0,0-1.12.91.83.83,0,0,0,.1.42,2.23,2.23,0,0,0,1.31.88c1.62.7,2.31,1.16,2.74,1.81a3.28,3.28,0,0,1,.26,2.76A3,3,0,0,1,27.31,30a6.93,6.93,0,0,1-1.72,0,4.15,4.15,0,0,1-2.3-1.2,4,4,0,0,1-.59-.87l.21-.13.84-.48.65-.38.14.2a3,3,0,0,0,.86.82,2.1,2.1,0,0,0,2.2-.11,1,1,0,0,0,.13-1.25,3.72,3.72,0,0,0-1.55-.9A5.6,5.6,0,0,1,24,24.32a3,3,0,0,1-.62-1.13,4.53,4.53,0,0,1,0-1.44A2.76,2.76,0,0,1,25.7,19.6,5.73,5.73,0,0,1,27.41,19.65Zm-5.31.94v.93H19.16v8.36H17.08V21.52H14.14v-.91a8.9,8.9,0,0,1,0-.93h8v.92Z" style="fill:#007acc"/></svg></span> upload-task.component.ts
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">ChangeDetectorRef</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireStorage</span><span class="p">,</span> <span class="nx">AngularFireUploadTask</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/fire/storage&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFirestore</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/fire/firestore&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">finalize</span><span class="p">,</span> <span class="nx">tap</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;upload-task&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./upload-task.component.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./upload-task.component.scss&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">UploadTaskComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">()</span> <span class="nx">file</span>: <span class="kt">File</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">task</span>: <span class="kt">AngularFireUploadTask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">percentage</span>: <span class="kt">Observable</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">snapshot</span>: <span class="kt">Observable</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">downloadURL</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">storage</span>: <span class="kt">AngularFireStorage</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">db</span>: <span class="kt">AngularFirestore</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">startUpload</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">startUpload() {</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The storage path
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="sb">`test/</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Reference to storage bucket
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">ref</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The main task
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">task</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">upload</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Progress monitoring
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">percentage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">percentageChanges</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">snapshot</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">snapshotChanges</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">tap</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// The file&#39;s download URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">finalize</span><span class="p">(</span> <span class="kr">async</span><span class="p">()</span> <span class="o">=&gt;</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">downloadURL</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">getDownloadURL</span><span class="p">().</span><span class="nx">toPromise</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span> <span class="p">{</span> <span class="nx">downloadURL</span>: <span class="kt">this.downloadURL</span><span class="p">,</span> <span class="nx">path</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">isActive</span><span class="p">(</span><span class="nx">snapshot</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">snapshot</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;running&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">snapshot</span><span class="p">.</span><span class="nx">bytesTransferred</span> <span class="o">&lt;</span> <span class="nx">snapshot</span><span class="p">.</span><span class="nx">totalBytes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The final result should look something like this:</p>
<p><video controls src="https://firebasestorage.googleapis.com/v0/b/Kodeville-app.appspot.com/o/assets%2FE168-Uploads%2F16-demo2.mp4?alt=media&amp;token=38092335-9fed-4ad9-844b-446188e3e3dd"></video></p>


				
			</section>

			<section id="qna" class="my-12 flex flex-col justify-between items-center">
    <h2 class="text-2xl mb-4">Questions? Let's chat</h2>
    <a href="https://discord.gg/SpDdJ3qaKK" class="btn btn-purple btn-lg btn-glow btn-display mx-auto"><span class="w-8 mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></span> Open Discord</a>
    <div class="mt-3">
        <discord-count></discord-count>
    </div>
</section>

		</article>
		
		
		<aside class="tableOfContents">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#step-0---prerequisites">Step 0 - Prerequisites</a>
      <ul>
        <li><a href="#base-css-styles">Base CSS Styles</a></li>
      </ul>
    </li>
    <li><a href="#step-1---directive-to-receive-files-from-the-browser">Step 1 - Directive to Receive Files from the Browser</a>
      <ul>
        <li><a href="#emit-files-as-a-custom-event">Emit Files as a Custom Event</a></li>
      </ul>
    </li>
    <li><a href="#step-2---uploader-component">Step 2 - Uploader Component</a>
      <ul>
        <li><a href="#listen-to-file-drop">Listen to File Drop</a></li>
      </ul>
    </li>
    <li><a href="#step-3---upload-task-component">Step 3 - Upload Task Component</a>
      <ul>
        <li><a href="#show-progress-and-provide-user-controls">Show Progress and Provide User Controls</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		
	</div>


</main>

    
<footer class="container text-center my-6 p-8 text-gray3">
    <div class="mx-auto w-24 h-1 my-12 bg-gradient-to-r from-gray5 to-gray4 rounded-full"></div>
    <div class="pt-10">Find an issue with this page? <a class="text-blue-500" href="https://github.com/k0deville/k0deville.github.io">Fix it on GitHub</a></div>

    <div class="py-3">
        Need help? Email <a href="mailto:kodeville97@gmail.com"><strong class="text-white font-bold">kodeville97@gmail.com</strong></a>
    </div>
    <div class="flex justify-center items-center my-2">
        <a href="https://www.youtube.com/c/Kodeville"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svgyoutube  "><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" ></path></svg></i></a>
        <a href="https://twitter.com/Kodeville_dev"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svgtwitter  "><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" ></path></svg></i></a>
        <a href="https://github.com/Kodeville-io"><i class="w-6 inline-block mx-2"><svg aria-hidden="true" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svggithub "><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" ></path></svg></i></a>
        <a href="https://discord.gg/SpDdJ3qaKK"><i class="w-6 inline-block mx-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg></i></a>
    </div>

    <h6>Helpful Links</h6>

    <div class="py-3">
        <a href="../../courses/index.html">Courses</a> | 
        <a href="../index.html">Labs</a> | 
        <a href="../../snippets/index.html">Snippets</a> | 
        <a href="../../tags/index.html">Tags</a> | 
        <a href="../../contributors/index.html">Contrib</a> |
        <a href="../../privacy/index.html">Privacy</a> | 
        <a href="../../terms/index.html">Terms</a>
    </div>

    
    <div class="text-xs">
        Copyright 2023 KodeVille Pvt Ltd<br> 
    </div>

</footer>




    <app-signin></app-signin>
    <algolia-search></algolia-search>
    <hi-mom></hi-mom>

    <email-handler></email-handler>

    <route-loader>
      <div class="fixed w-full top-0 left-0 h-1 gradient-loader"></div>
    </route-loader>

    <toast-message></toast-message>
    <scroll-up></scroll-up>

    </div>

  </body>

<!-- Mirrored from Kodeville.io/lessons/angular-firebase-storage-uploads-multi/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Jan 2024 17:09:50 GMT -->
</html>